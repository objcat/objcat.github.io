# ğŸ ç®€ä»‹

```
ioGame
æ— é”å¼‚æ­¥åŒ–ã€äº‹ä»¶é©±åŠ¨çš„æ¶æ„è®¾è®¡ï¼›è½»é‡çº§ï¼Œæ— éœ€ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶æˆ–æ•°æ®åº“å°±èƒ½æ”¯æŒé›†ç¾¤ã€åˆ†å¸ƒå¼
é€šè¿‡ ioGame å¯ä»¥å¾ˆå®¹æ˜“çš„æ­å»ºå‡ºä¸€ä¸ªé›†ç¾¤æ— ä¸­å¿ƒèŠ‚ç‚¹ã€é›†ç¾¤è‡ªåŠ¨åŒ–ã€å¤šè¿›ç¨‹çš„åˆ†å¸ƒå¼æ¸¸æˆæœåŠ¡å™¨
åŒ…ä½“å°ã€å¯åŠ¨å¿«ã€å†…å­˜å ç”¨å°‘ã€æ›´åŠ çš„èŠ‚çº¦ã€æ— éœ€é…ç½®æ–‡ä»¶ã€æä¾›äº†ä¼˜é›…çš„è·¯ç”±è®¿é—®æƒé™æ§åˆ¶
å¯åŒæ—¶æ”¯æŒå¤šç§è¿æ¥æ–¹å¼ï¼šWSã€UDPã€TCP...ç­‰ï¼›æ¡†æ¶å·²æ”¯æŒå…¨é“¾è·¯è°ƒç”¨æ—¥å¿—è·Ÿè¸ªç‰¹æ€§
è®©å¼€å‘è€…ç”¨ä¸€å¥—ä¸šåŠ¡ä»£ç ï¼Œèƒ½è½»æ¾åˆ‡æ¢å’Œæ‰©å±•ä¸åŒçš„æ•°æ®åè®®ï¼šProtobufã€JSON
è¿‘åŸç”Ÿçš„æ€§èƒ½ï¼›ä¸šåŠ¡æ¡†æ¶åœ¨å•çº¿ç¨‹ä¸­å¹³å‡æ¯ç§’å¯ä»¥æ‰§è¡Œ 1152 ä¸‡æ¬¡ä¸šåŠ¡é€»è¾‘
ä»£ç å³è”è°ƒæ–‡æ¡£ã€JSR380éªŒè¯ã€æ–­è¨€ + å¼‚å¸¸æœºåˆ¶ = æ›´å°‘çš„ç»´æŠ¤æˆæœ¬
æ¡†æ¶å…·å¤‡æ™ºèƒ½çš„åŒè¿›ç¨‹äº²å’Œæ€§ï¼›å¼€å‘ä¸­ï¼Œä¸šåŠ¡ä»£ç å¯å®šä½ä¸è·³è½¬
æ¶æ„éƒ¨ç½²çµæ´»æ€§ä¸å¤šæ ·æ€§ï¼šæ—¢å¯ç›¸äº’ç‹¬ç«‹ï¼Œåˆå¯ç›¸äº’èåˆ
ä¸€æ¬¡ç¼–å†™åˆ°å¤„å¯¹æ¥ï¼Œèƒ½ä¸ºå®¢æˆ·ç«¯ç”Ÿæˆå¯äº¤äº’çš„ä»£ç 
é€»è¾‘æœä¹‹é—´å¯ç›¸äº’è·¨è¿›ç¨‹ã€è·¨æœºå™¨è¿›è¡Œé€šä¿¡
æ”¯æŒç©å®¶å¯¹æ¸¸æˆé€»è¾‘æœè¿›è¡ŒåŠ¨æ€ç»‘å®š
èƒ½ä¸ä»»ä½•å…¶ä»–æ¡†æ¶åšèåˆå…±å­˜
å¯¹ webMVC å¼€å‘è€…å‹å¥½
æ—  spring å¼ºä¾èµ–
é›¶å­¦ä¹ æˆæœ¬
javaSE
```

https://iohao.github.io/game/

# ğŸ å¿«é€Ÿå¼€å§‹

## ğŸŒ² ç¯å¢ƒ

è¿™æ˜¯æˆ‘çš„ç¯å¢ƒ

- IDEA 2025.1
- MAVEN 3.9.11
- JAVA21

è¯¥ä¸‹çš„ä¸‹, è¯¥é…çš„é…, éƒ½å‡†å¤‡å¥½

## ğŸŒ² å¯åŠ¨æœåŠ¡ç«¯

æˆ‘ä»¬ç›´æ¥ä¸‹è½½ä»–çš„`Demo`

https://github.com/iohao/ioGameSimpleOne

ç„¶åæˆ‘ä»¬æ‰“å¼€é¡¹ç›®

![](images/Pasted%20image%2020250819183413.png)

é…ç½®`maven`

[mavenæ•™ç¨‹](../../../4-package-manager/maven/maven.md)

ç„¶åç›´æ¥æ‹‰å–ä¾èµ–...

å¥½çš„è¿›å…¥æ­£é¢˜, æ ¹æ®æ–‡æ¡£æˆ‘ä»¬çŸ¥é“äº†ä¸¤ä»¶äº‹

```
è¿è¡Œæ­¥éª¤

æœåŠ¡å™¨å¯åŠ¨ç±» DemoApplication.java
æ¨¡æ‹Ÿå®¢æˆ·ç«¯å¯åŠ¨ç±» DemoClient.java
```

å¯ä»¥çœ‹å¾—å‡ºæ¥ä½œè€…éå¸¸è´´å¿ƒ, è®¾è®¡äº†å¯åŠ¨æœåŠ¡å™¨çš„æ¡ˆä¾‹å’Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯è¿æ¥çš„æ¡ˆä¾‹, æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°`DemoApplication`, ç„¶åç›´æ¥å³é”®å¯åŠ¨å°±è¡Œ

```java
package com.iohao.one.example;

import com.iohao.game.external.core.netty.simple.NettySimpleHelper;

import java.util.List;
import java.util.Locale;

/**
 * @author æ¸”æ°‘å°é•‡
 * @date 2023-01-06
 */
public class DemoApplication {
    public static void main(String[] args) {
        Locale.setDefault(Locale.US);
        // æ¸¸æˆå¯¹å¤–æœç«¯å£
        int port = 10100;
        // æ¸¸æˆé€»è¾‘æœ
        var demoLogicServer = new DemoLogicServer();
        // å¯åŠ¨
        NettySimpleHelper.run(port, List.of(demoLogicServer));
    }
}
```

å¯åŠ¨åæ˜¯è¿™æ ·çš„æ—¥å¿—

```shell
Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
37:53 [ain] INFO  c.a.s.c.log.report(ReportUtil.java:30) Sofa-Middleware-Log SLF4J : Actual binding is of type [ com.alipay.remoting Logback ]
37:54 [d-3] INFO  CommonStdout.createMicroBootstrap(DefaultExternalCore.java:71) GameExternalServer port: [10100] - Connection way: [WebSocket] 
37:54 [d-1] INFO  CommonStdout.extractedLog(BrokerServer.java:113) GameBrokerServer port:[10200] - Startup Mode:[Standalone] 
37:54 [d-1] INFO  ConnectionTopic.extractedPrint(ConnectionEventBrokerProcessor.java:87) Broker ConnectionEventType:ã€CONNECTã€‘ remoteAddress:ã€127.0.0.1:53141ã€‘ï¼ŒConnection:ã€com.alipay.remoting.Connection@73880afdã€‘
37:54 [6-3] INFO  ConnectionTopic.extracted(ConnectEventClientProcessor.java:86) ConnectionEventType:ã€CONNECTã€‘ remoteAddress:ã€127.0.0.1:10200ã€‘ï¼ŒNumber of GameBrokerServer connections:ã€1ã€‘ï¼ŒregisterActive:ã€0ã€‘
37:54 [d-2] INFO  CommonStdout.print(RegisterBrokerClientModuleMessageBrokerProcessor.java:129) Module registration information --- GameBrokerServer port: [10200] --- BrokerClientModuleMessage(header={}, name=GameExternalServer, tag=external, status=1, withNo=-1488348302, brokerClientType=EXTERNAL, id=a1263671-9f6d-45d5-bef0-422fd0ea8733, idHash=-1279349633, address=127.0.0.1:53141, ioGamePid=86aff8cd-bef6-49cb-a483-b85d6abd6458)
37:54 [d-2] INFO  CommonStdout.print(BrokerPrintKit.java:73) GameBrokerServer:10200 --- gameLogicServerList: 
	{Number of servers:1, tag:'external'}
======================== ioGame Business Framework ========================= 
21.30
BLACK RED GREEN YELLOW BLUE MAGENTA CYAN WHITE DEFAULT
======================== Handler ========================= 
To turn off printing, see BarSkeletonBuilder.setting.printHandler
class com.iohao.game.action.skeleton.core.ActionCommandHandler 
======================== Plugin ========================= 
To turn off printing, see BarSkeletonBuilder.setting.printInout
class com.iohao.game.action.skeleton.core.flow.internal.DebugInOut 
======================== DataCodec ========================= 
To turn off printing, see BarSkeletonBuilder.setting.printDataCodec
j-protobuf - com.iohao.game.action.skeleton.core.codec.ProtoDataCodec 
======================== action ========================= 
To turn off printing, see BarSkeletonBuilder.setting.printAction
Print the full package name, see BarSkeletonBuilder.setting.printActionShort
Routing: 1 - 0 --- action : DemoAction.here(HelloMessage helloMessage)  --- return HelloMessage  ~~~ see.(DemoAction.java:43)
Routing: 1 - 1 --- action : DemoAction.jackson(HelloMessage helloMessage)  --- return HelloMessage  ~~~ see.(DemoAction.java:56)
Routing: 1 - 2 --- action : DemoAction.list()  --- return List<HelloMessage>  ~~~ see.(DemoAction.java:69)

37:54 [6-3] INFO  ConnectionTopic.extracted(ConnectEventClientProcessor.java:86) ConnectionEventType:ã€CONNECTã€‘ remoteAddress:ã€127.0.0.1:10200ã€‘ï¼ŒNumber of GameBrokerServer connections:ã€1ã€‘ï¼ŒregisterActive:ã€0ã€‘
37:54 [d-1] INFO  ConnectionTopic.extractedPrint(ConnectionEventBrokerProcessor.java:87) Broker ConnectionEventType:ã€CONNECTã€‘ remoteAddress:ã€127.0.0.1:53142ã€‘ï¼ŒConnection:ã€com.alipay.remoting.Connection@1f23d074ã€‘
37:54 [d-4] INFO  CommonStdout.print(RegisterBrokerClientModuleMessageBrokerProcessor.java:129) Module registration information --- GameBrokerServer port: [10200] --- BrokerClientModuleMessage(header={}, name=demoLogicServer, tag=demoLogicServer, status=1, withNo=-1488348302, brokerClientType=LOGIC, id=0d986c28-f5f7-4ea7-8a30-6ad76bdab9fb, idHash=789338557, address=127.0.0.1:53142, ioGamePid=86aff8cd-bef6-49cb-a483-b85d6abd6458)
37:54 [d-4] INFO  CommonStdout.print(BrokerPrintKit.java:73) GameBrokerServer:10200 --- gameLogicServerList: 
	{Number of servers:1, tag:'demoLogicServer'}
	{Number of servers:1, tag:'external'}

.------..------..------..------..------..------.
|I.--. ||O.--. ||G.--. ||A.--. ||M.--. ||E.--. |
| (\/) || :/\: || :/\: || (\/) || (\/) || (\/) |
| :\/: || :\/: || :\/: || :\/: || :\/: || :\/: |
| '--'I|| '--'O|| '--'G|| '--'A|| '--'M|| '--'E|
`------'`------'`------'`------'`------'`------'

+----------+-----------------------##-------------+---------##---------+-------------------------
| ioGame                           ## Memory                ## Time                            
+----------+-----------------------##-------------+---------##---------+-------------------------
| pid      | 12924                 ## used        | 64.39MB ## start   | 2025-08-19 18:37:53.924 
| version  | 21.30                 ## freeMemory  | 15.61MB ## end     | 2025-08-19 18:37:54.408 
| document | http://game.iohao.com ## totalMemory | 80.0MB  ## consume | 0.48 s                  
+----------+-----------------------##-------------+---------##---------+-------------------------
|          | ioGame issues - https://github.com/iohao/ioGame/issues
+----------+--------------------------------------------------------------------------------------
| adv      | Room games in action - https://iohao.github.io/game/docs/practices/room_in_action
+----------+--------------------------------------------------------------------------------------
| News     | Business Framework - Introduction - https://iohao.github.io/game/docs/core/framework
| News     | ExternalServer - User online and offline hooks - https://iohao.github.io/game/docs/external/user_hook
+----------+--------------------------------------------------------------------------------------
```

## ğŸŒ² å¯åŠ¨å®¢æˆ·ç«¯

æœåŠ¡ç«¯æˆ‘ä»¬å·²ç»å¯åŠ¨å¥½äº†, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸‹å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯, æ‰¾åˆ°`DemoClient.java`

```java
/*
 * ioGame
 * Copyright (C) 2021 - 2023  æ¸”æ°‘å°é•‡ ï¼ˆ262610965@qq.comã€luoyizhu@gmail.comï¼‰ . All Rights Reserved.
 * # iohao.com . æ¸”æ°‘å°é•‡
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
package com.iohao.one.example.client;

import com.iohao.game.external.client.join.ClientRunOne;
import com.iohao.game.external.client.kit.ClientUserConfigs;

import java.util.List;

/**
 * @author æ¸”æ°‘å°é•‡
 * @date 2023-07-17
 */
public class DemoClient {
    public static void main(String[] args) {
        // closeLog. cn: å…³é—­æ¨¡æ‹Ÿè¯·æ±‚ç›¸å…³æ—¥å¿—
        ClientUserConfigs.closeLog();
        // Startup Client. cn: å¯åŠ¨æ¨¡æ‹Ÿå®¢æˆ·ç«¯
        new ClientRunOne()
                .setInputCommandRegions(List.of(new DemoRegion()))
                .startup();
    }
}
```

ç„¶åæˆ‘ä»¬ç›´æ¥å³é”®è¿è¡Œ, æ¨¡æ‹Ÿå®¢æˆ·ç«¯å¯åŠ¨æ˜¯è¿™æ ·çš„, çœ‹åˆ°è¿™ä¸ªç•Œé¢è¯´æ˜æˆ‘ä»¬å·²ç»å’ŒæœåŠ¡å™¨`è¿æ¥æˆåŠŸäº†`, å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨å®¢æˆ·ç«¯ä¼šæç¤ºæ¥è¿æ¥é”™è¯¯

```shell
41:39 [ain] INFO  CommonStdout.startup(ClientRunOne.java:99) å¯åŠ¨æˆåŠŸ
æç¤ºï¼š[å‘½ä»¤æ‰§è¡Œ : cmd-subCmd] [é€€å‡º : q] [å¸®åŠ© : help]
```

ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸‹å»è¾“å…¥æŒ‡ä»¤`help`å°±æ˜¯å¼¹å‡ºå¸®åŠ©èœå•

```shell
help
---------- cmd help ----------
1-0    :    here
1-1    :    Jackson
1-2    :    list
```

ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½œè€…æä¾›äº†å‡ ä¸ªå‘½ä»¤è®©æˆ‘ä»¬å°è¯•, æˆ‘ä»¬å…ˆè¯•è¯•`1-0`

```shell
1-0
1-0    :    here
æç¤ºï¼š[å‘½ä»¤æ‰§è¡Œ : cmd-subCmd] [é€€å‡º : q] [å¸®åŠ© : help]
42:19 [-47] INFO  c.i.o.e.c.DemoRegion.lambda$initInputCommand$1(DemoRegion.java:49) HelloMessage{name='1, I'm here'}
```

å¯ä»¥çœ‹åˆ°æ˜¯æœ‰è¾“å‡ºçš„, æˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡å™¨çš„æ—¥å¿—

```shell
â”â”â”â”â”â” Debug. [(DemoAction.java:43).here] â”â”â”â”â” [cmd:1-0 65536] â”â”â”â”â” [demoLogicServer] â”â”â”â”â” [id:0d986c28-f5f7-4ea7-8a30-6ad76bdab9fb]
â”£ userId: 0
â”£ RequestParam: helloMessage : HelloMessage{name='1'}
â”£ ResponseData: HelloMessage{name='1, I'm here'}
â”£ ExecutionTime: 7 ms
	â”—â”â”â”â”â” [ioGame:21.30] â”â”â”â”â” [Thread:User-16-4] â”â”â”â”â” [Connection way:WebSocket] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

ä¸å¾—ä¸è¯´, è¿™ä¸ªæ—¥å¿—æ ¼å¼åšçš„çœŸæ˜¯`èµå¿ƒæ‚¦ç›®`, æˆ‘è¿™é‡Œæˆ‘ä»¬çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å·²ç»å¯ä»¥é€šä¿¡äº†

## ğŸŒ² æŸ¥çœ‹socketçš„è¿æ¥æƒ…å†µ

æˆ‘ä»¬ä½¿ç”¨`netstat`å‘½ä»¤

```shell
netstat -ano | findstr ":10100"

TCP    0.0.0.0:10100          0.0.0.0:0              LISTENING       12924
TCP    127.0.0.1:10100        127.0.0.1:53344        ESTABLISHED     12924
TCP    127.0.0.1:53344        127.0.0.1:10100        ESTABLISHED     31220
TCP    [::]:10100             [::]:0                 LISTENING       12924
```

å¯ä»¥çœ‹åˆ°`[::]:10100å’Œ0.0.0.0:10100`è¡¨ç¤ºæœåŠ¡å™¨åœ¨`10100`ç«¯å£ä½¿ç”¨`IPV6å’ŒIPV4`è¿›è¡Œ`LISTENING`ç›‘å¬

```
TCP    127.0.0.1:10100        127.0.0.1:53344        ESTABLISHED     12924
TCP    127.0.0.1:53344        127.0.0.1:10100        ESTABLISHED     31220
```

ä¸­é—´çš„ä¸¤æ¡è¡¨ç¤º`å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯`å·²ç»å»ºç«‹äº†`TCP`è¿æ¥, ä¸€ä¸ª TCP è¿æ¥åªæœ‰ä¸€æ¡(åè®®å±‚é¢)ï¼Œä½†æ˜¯åœ¨æ“ä½œç³»ç»Ÿé‡Œ,, `æœåŠ¡ç«¯`å’Œ`å®¢æˆ·ç«¯`å„è‡ªæŒæœ‰ä¸€ä¸ª socket, æ‰€ä»¥`netstat`ä¼šæ˜¾ç¤ºä¸¤æ¡è®°å½•, è¿™ä¸¤ä¸ª socket äº’ä¸ºå¯¹ç«¯, å®ƒä»¬æ„æˆå®Œæ•´çš„åŒå‘é€šä¿¡é€šé“

# ğŸ æ¶æ„

å­¦ä¸€ä¸ªä¸œè¥¿è¦å…ˆäº†è§£ä¸€ä¸‹æ¶æ„çŸ¥è¯†, ä¸ç„¶å­¦ç€å­¦ç€å°±æ‡µäº†, è¿™é‡Œå¼•ç”¨å®˜æ–¹çš„å›¾

![](images/Pasted%20image%2020250819200125.png)

ä»æ¶æ„ç®€å›¾ä¸­, æˆ‘ä»¬çŸ¥é“äº†æ•´ä½“æ¶æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆ, åˆ†åˆ«æ˜¯

- 1.æ¸¸æˆå¯¹å¤–æœ
- 2.æ¸¸æˆç½‘å…³
- 3.æ¸¸æˆé€»è¾‘æœï¼Œ

ä¸‰è€…æ—¢å¯ç›¸äº’ç‹¬ç«‹ï¼Œåˆå¯ç›¸äº’èåˆã€‚

æˆ‘è§‰å¾—ä½œè€…è®¾è®¡çš„éå¸¸å¥½, å¯ä»¥ç›¸äº’ç‹¬ç«‹å’Œå¯ä»¥èåˆ, ç‹¬ç«‹æ–¹ä¾¿æˆ‘ä»¬å»æ‹“å±•ä¸šåŠ¡, èåˆå¯ä»¥åœ¨å•åº”ç”¨æ—¶èŠ‚çœå¤§é‡çš„éƒ¨ç½²æ—¶é—´

ä¸‹é¢æ˜¯ä½œè€…çš„ä»‹ç»

```
æ¸¸æˆå¯¹å¤–æœã€Brokerï¼ˆæ¸¸æˆç½‘å…³ï¼‰ã€æ¸¸æˆé€»è¾‘æœè¿™ä¸‰éƒ¨åˆ†ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚(å•ä½“åº”ç”¨ï¼Œåœ¨å¼€å‘åˆ†å¸ƒå¼æ—¶ï¼Œè°ƒè¯•æ›´åŠ æ–¹ä¾¿)
æ¸¸æˆå¯¹å¤–æœã€Brokerï¼ˆæ¸¸æˆç½‘å…³ï¼‰ã€æ¸¸æˆé€»è¾‘æœè¿™ä¸‰éƒ¨åˆ†ï¼Œåœ¨å¤šä¸ªè¿›ç¨‹ä¸­ã€‚(åˆ†å¸ƒå¼)
æ¸¸æˆå¯¹å¤–æœã€Brokerï¼ˆæ¸¸æˆç½‘å…³ï¼‰è¿™ä¸¤éƒ¨åˆ†åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œæ¸¸æˆé€»è¾‘æœåœ¨å¤šä¸ªè¿›ç¨‹ä¸­ã€‚(ç±»ä¼¼ä¹‹å‰æ¸¸æˆçš„ä¼ ç»Ÿæ¶æ„)
ç”šè‡³å¯ä»¥ä¸éœ€è¦æ¸¸æˆå¯¹å¤–æœï¼Œåªä½¿ç”¨ Brokerï¼ˆæ¸¸æˆç½‘å…³ï¼‰å’Œæ¸¸æˆé€»è¾‘æœè¿™ä¸¤éƒ¨åˆ†ï¼Œç”¨äºå…¶ä»–ç³»ç»Ÿä¸šåŠ¡ã€‚

å› ä¸º ioGame éµå¾ªé¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ï¼ˆå•ä¸€èŒè´£åŸåˆ™ã€å¼€é—­åŸåˆ™ã€é‡Œå¼æ›¿æ¢åŸåˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™ã€æ¥å£éš”ç¦»åŸåˆ™ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼‰ç­‰ï¼Œ æ‰€ä»¥ä½¿å¾—æ¶æ„çš„èŒè´£åˆ†æ˜ï¼Œå¯ä»¥çµæ´»çš„è¿›è¡Œç»„åˆã€‚

å¼€å‘äººå‘˜å‡ ä¹éƒ½é‡è§è¿‡è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œåœ¨é¡¹ç›®åˆæœŸé˜¶æ®µï¼Œé€šå¸¸æ˜¯ä»¥å•ä½“é¡¹ç›®çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œéšç€éœ€æ±‚ä¸æ–­çš„å¢åŠ ä¸è¿­ä»£ï¼Œä¼šæ¼”å˜æˆä¸€ä¸ªè‡ƒè‚¿çš„é¡¹ç›®ã€‚ æ­¤æ—¶åœ¨å¯¹ä¸€ä¸ªæ•´ä½“è¿›è¡Œæ‹†åˆ†æ˜¯å›°éš¾çš„ï¼Œæˆæœ¬æ˜¯æé«˜çš„ã€‚ç”šè‡³æ˜¯ä¸å¯å®Œæˆçš„ï¼Œæœ€åå¯¼è‡´å®Œå…¨çš„é‡æ–°é‡æ„ã€‚

ioGame æä¾›äº†åœ¨ç»“æ„ç»„åˆä¸Šçš„éƒ¨ç½²å¤šæ ·æ€§ï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œåœ¨é¡¹ç›®åˆæœŸå°±å¯ä»¥é¿å…è¿™äº›æ‹†åˆ†é—®é¢˜ã€‚ åœ¨å¼€å‘é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä½“åº”ç”¨å¼€å‘æ€ç»´ï¼Œé™ä½äº†å¼€å‘æˆæœ¬ã€‚ é€šè¿‡å•ä½“åº”ç”¨çš„å¼€å‘æ–¹å¼ï¼Œåœ¨å¼€å‘åˆ†å¸ƒå¼é¡¹ç›®æ—¶ï¼Œè°ƒè¯•æ›´åŠ çš„æ–¹ä¾¿ã€‚ è¿™æ—¢èƒ½å…¼é¡¾åˆ†å¸ƒå¼å¼€å‘ã€é¡¹ç›®æ¨¡å—çš„æ‹†åˆ†ï¼Œåˆèƒ½é™ä½å›¢é˜Ÿçš„å¼€å‘æˆæœ¬ã€‚
```

å¯ä»¥çœ‹åˆ°ä½œè€…éå¸¸æ‡‚æ¶æ„çš„, è€Œä¸”è€ƒè™‘åˆ°äº†å¼€å‘åˆæœŸåˆ°åæœŸçš„è¿™ä¸ªè¿‡ç¨‹, æœåŠ¡å™¨çš„å˜åŒ–

æˆ‘ä»¬æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£, ä»–è¯´

```
æ¸¸æˆé€»è¾‘æœéœ€è¦ç»§æ‰¿ AbstractBrokerClientStartup ï¼Œ æœ‰ä¸‰ä¸ªæ–¹æ³•éœ€è¦å®ç°

createBarSkeletonï¼Œå½“å‰æ¸¸æˆé€»è¾‘æœä½¿ç”¨çš„ä¸šåŠ¡æ¡†æ¶ã€‚
createBrokerClientBuilderï¼Œå½“å‰æ¸¸æˆé€»è¾‘æœä¿¡æ¯ã€‚
createBrokerAddressï¼Œæ¸¸æˆç½‘å…³çš„è¿æ¥åœ°å€ã€‚
```

# ğŸ ä¸‰å±‚æ¶æ„

æˆ‘ä»¬åˆšæ‰ç®€å•äº†è§£äº†`æ•´ä½“æ¶æ„`, ç°åœ¨å°±åˆ†åˆ«å­¦ä¹ è¿™ä¸‰ä¸ªæ¨¡å—, æˆ‘ç»™ä»–çš„èµ·çš„å`ä¸‰å±‚æ¶æ„`, å“ˆå“ˆ

## ğŸŒ² é€»è¾‘æœ

å› ä¸ºå®ƒç¦»æˆ‘ä»¬æœ€è¿‘, æˆ‘å°±å…ˆå­¦è¿™ä¸ª

### ğŸŒ¸ ä»å…¥å£å‡ºå‘

é€»è¾‘æœå°±æ˜¯æˆ‘ä»¬å†™ä¸šåŠ¡çš„æœåŠ¡å™¨, æœ¬äººç†è§£åº”è¯¥æ˜¯ç±»ä¼¼äº`spring`ä¸­çš„`Controller`æ§åˆ¶å™¨, å› ä¸ºå®ƒèƒ½å†™ä¸šåŠ¡, ä½†æ˜¯åˆä¸å®Œå…¨ä¸€æ ·, å› ä¸ºå®ƒæ˜¯æœåŠ¡å™¨çš„è§’è‰², æˆ‘ä»¬å…ˆä»`æœåŠ¡ç«¯å…¥å£`æ¥çœ‹, å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®æ€§ä»£ç 

```java
// æ¸¸æˆé€»è¾‘æœ
var demoLogicServer = new DemoLogicServer();
// å¯åŠ¨
NettySimpleHelper.run(port, List.of(demoLogicServer));
```

å¾ˆæ˜æ˜¾è¿™ä¸ªå°±æ˜¯åˆ›å»ºä¸€ä¸ª`DemoLogicServer`, ç„¶ååœ¨å¯åŠ¨çš„æ—¶å€™åº”ç”¨å®ƒ, å°±èƒ½ç»™æˆ‘ä»¬æœåŠ¡å™¨æä¾›æœåŠ¡äº†, æˆ‘ä»¬æ¥çœ‹çœ‹`DemoLogicServer`çš„ä»£ç 

```java
public class DemoLogicServer extends AbstractBrokerClientStartup {
    @Override
    public BarSkeleton createBarSkeleton() {
        // ä¸šåŠ¡æ¡†æ¶æ„å»ºå™¨ é…ç½®
        var config = new BarSkeletonBuilderParamConfig()
                // æ‰«æ action ç±»æ‰€åœ¨åŒ…
                .scanActionPackage(DemoAction.class);

        // ä¸šåŠ¡æ¡†æ¶æ„å»ºå™¨
        var builder = config.createBuilder();

        // æ·»åŠ æ§åˆ¶å°è¾“å‡ºæ’ä»¶
        builder.addInOut(new DebugInOut());

        return builder.build();
    }

    @Override
    public BrokerClientBuilder createBrokerClientBuilder() {
        BrokerClientBuilder builder = BrokerClient.newBuilder();
        builder.appName("demoLogicServer");
        return builder;
    }

    @Override
    public BrokerAddress createBrokerAddress() {
        String localIp = "127.0.0.1";
        int brokerPort = IoGameGlobalConfig.brokerPort;
        return new BrokerAddress(localIp, brokerPort);
    }
}
```

å’Œå®˜æ–¹è¯´çš„ä¸€æ ·, æˆ‘ä»¬è¦å®ç°ä¸‰ä¸ªæ–¹æ³•, ä¸‹é¢æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçœ‹

### ğŸŒ¸ createBarSkeleton

è¿™ä¸ªæ–¹æ³•ç”¨äºé…ç½®`å½“å‰æ¸¸æˆé€»è¾‘æœä½¿ç”¨çš„ä¸šåŠ¡æ¡†æ¶`, æˆ‘ä»¬æ¥çœ‹ä»£ç 

```java
// ä¸šåŠ¡æ¡†æ¶æ„å»ºå™¨ é…ç½®
var config = new BarSkeletonBuilderParamConfig()
// æ‰«æ action ç±»æ‰€åœ¨åŒ…
.scanActionPackage(DemoAction.class);
```

è¿™ä¸ªå°±æ˜¯åˆ›å»ºä¸€ä¸ªé…ç½®, ç„¶åæŠŠ`DemoAction.class`ç»‘å®šä¸Šå»

```java
@ActionController(DemoCmd.cmd)
public class DemoAction {
    /**
     * ç¤ºä¾‹ here æ–¹æ³•
     *
     * @param helloMessage helloReq
     * @return HelloReq
     */
    @ActionMethod(DemoCmd.here)
    public HelloMessage here(HelloMessage helloMessage) {
        HelloMessage newHelloMessage = new HelloMessage();
        newHelloMessage.name = helloMessage.name + ", I'm here";
        return newHelloMessage;
    }
```

å¯ä»¥çœ‹åˆ°`DemoAction`ä¸­æ‰æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç , ä»£ç æœ€åæ˜¯é…ç½®äº†ä¸ª`æ—¥å¿—æ‰“å°å™¨`

```java
// ä¸šåŠ¡æ¡†æ¶æ„å»ºå™¨
var builder = config.createBuilder();
// æ·»åŠ æ§åˆ¶å°è¾“å‡ºæ’ä»¶
builder.addInOut(new DebugInOut());
return builder.build();
```

æœ€åè¿”å›çš„æ˜¯ä¸€ä¸ª`BarSkeleton`ä¸šåŠ¡æ¡†æ¶å¯¹è±¡

### ğŸŒ¸ createBarSkeleton

é…ç½®æ¸¸æˆç½‘å…³

```java
@Override
public BrokerClientBuilder createBrokerClientBuilder() {
	BrokerClientBuilder builder = BrokerClient.newBuilder();
	builder.appName("demoLogicServer");
	return builder;
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€å—ä»£ç éå¸¸å°‘, å®ƒåªæ˜¯é…ç½®äº†ä¸€ä¸ª`appName`ä¹Ÿå°±æ˜¯åº”ç”¨çš„åå­—, æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒé‡Œé¢è¿˜æœ‰å•¥

```java
public class BrokerClientBuilder {
    static final String ioGamePidRandom = UUID.randomUUID().toString();
    private final Map<ConnectionEventType, Supplier<ConnectionEventProcessor>> connectionEventProcessorMap = new NonBlockingHashMap();
    private final List<Supplier<UserProcessor<?>>> processorList = new ArrayList();
    private final List<Class<?>> removeProcessorList = new ArrayList();
    private final BrokerClientListenerRegion brokerClientListenerRegion = new BrokerClientListenerRegion();
    private String id;
    private String tag;
    private String appName;
    private BarSkeleton barSkeleton;
    private BrokerClientType brokerClientType;
    private BrokerAddress brokerAddress;
    private int timeoutMillis;
    private ClientProcessorHooks clientProcessorHooks;
    private BrokerClientManager brokerClientManager;
    private AwareInject awareInject;
    private int status;
    private int withNo;
```

å¯ä»¥çœ‹åˆ°å±æ€§è¿˜æ˜¯è›®å¤šçš„, è¿™ä¸€å—ä»–æ²¡å»åŠ¨, æˆ‘ä»¬ä¹Ÿå…ˆä¸åŠ¨, çŸ¥é“å°±è¡Œ

### ğŸŒ¸ createBrokerAddress

æ¸¸æˆç½‘å…³çš„è¿æ¥åœ°å€





