# ğŸ ç®€ä»‹

Flutteræ’ä»¶æ˜¯Flutteråº”ç”¨ç¨‹åºä¸åŸç”Ÿå¹³å°ä¹‹é—´çš„æ¡¥æ¢ï¼Œä½¿å¾—Flutteråº”ç”¨ç¨‹åºå¯ä»¥ä¸åŸç”Ÿä»£ç è¿›è¡Œäº¤äº’ï¼Œä»è€Œæ‰©å±•Flutteråº”ç”¨ç¨‹åºçš„åŠŸèƒ½å’Œèƒ½åŠ›ã€‚Flutteræ’ä»¶é€šå¸¸åŒ…æ‹¬Dartå’ŒåŸç”Ÿä»£ç ï¼ˆä¾‹å¦‚Javaã€Kotlinæˆ–Objective-Cã€Swiftç­‰ï¼‰ï¼Œå¹¶å¯ä»¥é€šè¿‡Flutteræ’ä»¶æ¡†æ¶æ¥æ³¨å†Œã€ç®¡ç†å’Œè°ƒç”¨ã€‚

åœ¨æ•´ä¸ªFlutteræ¶æ„ä¸­ï¼ŒFlutteræ’ä»¶å…·æœ‰éå¸¸é‡è¦çš„ä½œç”¨å’Œé‡è¦æ€§ã€‚ä»¥ä¸‹æ˜¯Flutteræ’ä»¶åœ¨Flutteræ¶æ„ä¸­çš„ä¸€äº›é‡è¦ä½œç”¨ï¼š

æ‰©å±•Flutteråº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼šFlutteræ’ä»¶å¯ä»¥æä¾›è®¸å¤šåŸç”Ÿå¹³å°çš„åŠŸèƒ½å’Œèƒ½åŠ›ï¼Œä¾‹å¦‚è®¿é—®åŸç”Ÿè®¾å¤‡APIã€è®¿é—®åŸç”ŸUIç»„ä»¶ç­‰ã€‚é€šè¿‡ä½¿ç”¨Flutteræ’ä»¶ï¼ŒFlutteråº”ç”¨ç¨‹åºå¯ä»¥è·å¾—æ›´å¤šçš„åŠŸèƒ½å’Œèƒ½åŠ›ï¼Œä»è€Œå¯ä»¥æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚
æé«˜Flutteråº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼šé€šè¿‡ä½¿ç”¨Flutteræ’ä»¶ï¼ŒFlutteråº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡åŸç”Ÿå¹³å°APIæ¥æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œä»è€Œå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨åŸç”Ÿå¹³å°çš„å›¾åƒå¤„ç†åº“æ¥å¤„ç†å¤§é‡å›¾åƒæ•°æ®ã€‚
ä¸åŸç”Ÿä»£ç è¿›è¡Œäº¤äº’ï¼šFlutteræ’ä»¶å¯ä»¥ä½¿Flutteråº”ç”¨ç¨‹åºä¸åŸç”Ÿä»£ç ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä»è€Œå¯ä»¥è®©Flutteråº”ç”¨ç¨‹åºä¸åŸç”Ÿå¹³å°è¿›è¡Œæ— ç¼é›†æˆã€‚è¿™å¯¹äºéœ€è¦ä¸ç°æœ‰åŸç”Ÿåº”ç”¨ç¨‹åºé›†æˆçš„Flutteråº”ç”¨ç¨‹åºæ¥è¯´å°¤ä¸ºé‡è¦ã€‚
ä¿ƒè¿›Flutterç”Ÿæ€ç³»ç»Ÿçš„å‘å±•ï¼šFlutteræ’ä»¶å¯ä»¥æä¾›è®¸å¤šä¸åŒç±»å‹çš„åŠŸèƒ½å’Œèƒ½åŠ›ï¼Œä¾‹å¦‚è®¿é—®åŸç”Ÿè®¾å¤‡ä¼ æ„Ÿå™¨ã€è®¿é—®åŸç”Ÿå¹¿å‘Šåº“ç­‰ã€‚é€šè¿‡å°†è¿™äº›æ’ä»¶å…±äº«ç»™å…¶ä»–Flutterå¼€å‘è€…ï¼ŒFlutteræ’ä»¶å¯ä»¥ä¿ƒè¿›Flutterç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å’Œå£®å¤§ï¼Œä½¿å¾—æ›´å¤šçš„å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨Flutteræ¥æ„å»ºé«˜è´¨é‡çš„åº”ç”¨ç¨‹åºã€‚

https://ducafecat.com/blog/flutter-plugin-channel

# ğŸ å¿«é€Ÿå¼€å§‹

## ğŸŒ² åˆ›å»ºæ’ä»¶é¡¹ç›®

æˆ‘ä»¬ç›´æ¥åœ¨`AndroidStudio`ä¸­å¯ä»¥å¿«é€Ÿåˆ›å»ºæ’ä»¶æ¨¡æ¿

![](images/Pasted%20image%2020240119235740.png)

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå«`test_flutter_plugin`çš„é¡¹ç›®, ç±»å‹é€‰æ‹©`Plugin`, åˆ›å»ºå®Œæˆåç›®å½•æ˜¯è¿™æ ·çš„

## ğŸŒ² ç›®å½•ç»“æ„

![](images/Pasted%20image%2020240119223957.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å½•æ¥å£è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„, æˆ‘ä»¬ä¸»è¦æ³¨æ„çš„æ˜¯`lib`å’Œ`example`

## ğŸŒ² lib

libå°±æ˜¯æˆ‘ä»¬æ’ä»¶çš„ä¸»å·¥ä½œåŒºäº†, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`lib`ä¸­æœ‰ä¸€äº›`dart`æ–‡ä»¶

| ç›®å½• | æ–‡ä»¶å | è¯´æ˜ |
| -- | -- | -- |
| lib | test_flutter_plugin.dart | æ¥å£è°ƒç”¨ç±» |
| lib | test_flutter_plugin_channel.dart | åŸç”ŸåŠŸèƒ½æ¥å£å®ç° |
| lib | test_flutter_plugin_platform_interface.dart | åŠŸèƒ½æ¥å£å®šä¹‰(åŒ…å«å¤šå¹³å°) |
| lib | test_flutter_plugin_web.dart | WebåŠŸèƒ½æ¥å£å®ç° |

### ğŸŒ¸ interface

æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ª`test_flutter_plugin_platform_interface.dart`, ä»å­—é¢ä¸Šç†è§£å°±æ˜¯ä¸€ä¸ªæ¥å£, æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç 

```dart
import 'package:plugin_platform_interface/plugin_platform_interface.dart';

import 'test_flutter_plugin_method_channel.dart';

abstract class TestFlutterPluginPlatform extends PlatformInterface {
  /// Constructs a TestFlutterPluginPlatform.
  TestFlutterPluginPlatform() : super(token: _token);

  static final Object _token = Object();

  static TestFlutterPluginPlatform _instance = MethodChannelTestFlutterPlugin();

  /// The default instance of [TestFlutterPluginPlatform] to use.
  ///
  /// Defaults to [MethodChannelTestFlutterPlugin].
  static TestFlutterPluginPlatform get instance => _instance;

  /// Platform-specific implementations should set this with their own
  /// platform-specific class that extends [TestFlutterPluginPlatform] when
  /// they register themselves.
  static set instance(TestFlutterPluginPlatform instance) {
    PlatformInterface.verifyToken(instance, _token);
    _instance = instance;
  }

  Future<String?> getPlatformVersion() {
    throw UnimplementedError('platformVersion() has not been implemented.');
  }
}
```

å¯ä»¥çœ‹åˆ°é‡Œé¢æ˜¯å†™äº†ä¸€ä¸ªæŠ½è±¡ç±», ç„¶åå£°æ˜äº†ä¸€äº›æ–¹æ³•, æˆ‘ä»¬ä¸»è¦å…³æ³¨`getPlatformVersion`, ä»å­—é¢æ„æ€ç†è§£å°±æ˜¯è·å–å¹³å°ç‰ˆæœ¬å·

### ğŸŒ¸ channel

æ‰“å¼€`test_flutter_plugin_channel.dart`æ–‡ä»¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`MethodChannelTestFlutterPlugin`ç»§æ‰¿äº†ä¸Šé¢çš„`TestFlutterPluginPlatform`æ¥å£å¹¶é‡å†™äº†`getPlatformVersion`æ–¹æ³•, å…¶ä¸­æœ€é‡è¦çš„æ˜¯`MethodChannel`è¿™æ˜¯æˆ‘ä»¬flutterä¸åŸç”Ÿäº¤äº’çš„æ ¸å¿ƒ

```dart
import 'package:flutter/foundation.dart';
import 'package:flutter/services.dart';

import 'test_flutter_plugin_platform_interface.dart';

/// An implementation of [TestFlutterPluginPlatform] that uses method channels.
class MethodChannelTestFlutterPlugin extends TestFlutterPluginPlatform {
  /// The method channel used to interact with the native platform.
  @visibleForTesting
  final methodChannel = const MethodChannel('test_flutter_plugin');

  @override
  Future<String?> getPlatformVersion() async {
    final version = await methodChannel.invokeMethod<String>('getPlatformVersion');
    return version;
  }
}
```

æˆ‘ä»¬åœ¨ä¸Šé¢çš„è¡¨æ ¼é‡Œè¯´äº†, è¿™æ˜¯å®ç°åŸç”Ÿç«¯ä»£ç çš„ç±»

### ğŸŒ¸ web

æˆ‘ä»¬æ‰“å¼€`test_flutter_plugin_web.dart`å¯ä»¥çœ‹åˆ°`TestFlutterPluginWeb`ä¹Ÿç»§æ‰¿äº`TestFlutterPluginPlatform`å¹¶é‡å†™äº†`getPlatformVersion`æ–¹æ³•

```dart
// In order to *not* need this ignore, consider extracting the "web" version
// of your plugin as a separate package, instead of inlining it in the same
// package as the core of your plugin.
// ignore: avoid_web_libraries_in_flutter
import 'dart:html' as html show window;

import 'package:flutter_web_plugins/flutter_web_plugins.dart';

import 'test_flutter_plugin_platform_interface.dart';

/// A web implementation of the TestFlutterPluginPlatform of the TestFlutterPlugin plugin.
class TestFlutterPluginWeb extends TestFlutterPluginPlatform {
  /// Constructs a TestFlutterPluginWeb
  TestFlutterPluginWeb();

  static void registerWith(Registrar registrar) {
    TestFlutterPluginPlatform.instance = TestFlutterPluginWeb();
  }

  /// Returns a [String] containing the version of the platform.
  @override
  Future<String?> getPlatformVersion() async {
    final version = html.window.navigator.userAgent;
    return version;
  }
}
```

ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º, flutteræ’ä»¶çš„å¼€å‘é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»æ¥è§„èŒƒä»£ç , ç„¶åå„ä¸ªå¹³å°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥å®ç°å¹³å°ç‹¬æœ‰çš„ä¸€äº›æ–¹æ³•, è¿™å°±æ˜¯flutterèƒ½åŒºåˆ†å„ä¸ªå¹³å°çš„åŸç†

## ğŸŒ² å¹³å°æºç åŒº

æ‰€è°“å¹³å°æºç åŒºå°±æ˜¯æŒ‡å„ä¸ªå¹³å°å®ç°è‡ªå·±åŸç”Ÿä»£ç çš„åœ°æ–¹, æ¯”å¦‚æˆ‘ä»¬å®‰å“ä¸­è·å–ç‰ˆæœ¬æ˜¯è¦ä»åŸç”Ÿä¸­è¿›è¡Œè·å–çš„, è¦å»å†™javaä»£ç 

æˆ‘ä»¬ä½¿ç”¨å®‰å“å¹³å°æ¥ä¸¾ä¾‹å­, æˆ‘ä»¬æ‰“å¼€é¡¹ç›®ç›®å½•ä¸­çš„å®‰å“, å¯ä»¥çœ‹åˆ°ç³»ç»Ÿç»™æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªå«`TestFlutterPlugin`çš„ç±», è¿™ä¸ªä»»ä½•äººéƒ½èƒ½çœ‹å‡ºæ¥å°±æ˜¯å®ç°æˆ‘ä»¬å®‰å“ç«¯æ’ä»¶ä»£ç çš„ä¸€ä¸ªç±»

![](images/Pasted%20image%2020240119231857.png)

ä½†æ˜¯æˆ‘ä»¬è¿›æ¥åå‘ç°é¡¹ç›®æ˜¯æŠ¥çº¢çš„, è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? æˆ‘ä»¬å°è¯•ä½¿ç”¨å°é£è±¡åŒæ­¥ä¸€ä¸‹å‘ç°è¿˜æ˜¯ä¸è¡Œ, ä¸è¦æ…Œæˆ‘ä»¬æ¥é…ç½®ä¸€ä¸‹, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`FlutterPlugin, MethodCallHandler`éƒ½æ˜¯æŠ¥çº¢çš„, è¿™äº›æ˜¯æˆ‘ä»¬flutterSDKä¸­çš„ä»£ç , æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨`gradle`ä¸­é…ç½®ä¸€ä¸‹, è®©IDEå¯ä»¥è¯†åˆ«åˆ°è¿™äº›ç±»

```groovy
//è·å–local.propertiesé…ç½®æ–‡ä»¶
def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
	localPropertiesFile.withReader('UTF-8') { reader ->
		localProperties.load(reader)
	}
}
//è·å–flutterçš„sdkè·¯å¾„
def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
	throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

dependencies {
	compileOnly files("$flutterRoot/bin/cache/artifacts/engine/android-arm/flutter.jar")
}

testOptions {
	unitTests.all {
		testLogging {
		   events "passed", "skipped", "failed", "standardOut", "standardError"
		   outputs.upToDateWhen {false}
		   showStandardStreams = true
		}
	}
}
```

ç„¶åæˆ‘ä»¬ç”¨å°é£è±¡åŒæ­¥ä¸€ä¸‹å‘ç°`import androidx.annotation.NonNull;`è¿˜æ˜¯æŠ¥é”™, æˆ‘ä»¬å¯¼å…¥ä¸‹é¢çš„åŒ…

```groovy
implementation('androidx.annotation:annotation:1.7.1')
```

ç„¶ååŒæ­¥ä¸€ä¸‹, æˆ‘ä»¬å‘ç°é—®é¢˜è§£å†³äº†

## ğŸŒ² example

ç†Ÿæ‚‰å®Œ`å¹³å°æºç åŒº`åæˆ‘ä»¬å†æ¥çœ‹`example`, é¡¾åæ€ä¹‰å°±æ˜¯ä¾‹å­, è¿™é‡Œæ˜¯è®©æˆ‘ä»¬å»æµ‹è¯•æ’ä»¶çš„åœ°æ–¹

![](images/Pasted%20image%2020240119230726.png)

æˆ‘ä»¬æ‰“å¼€æ–‡ä»¶å¤¹å‘ç°å„ä¸ªå¹³å°çš„é¡¹ç›®ä¹Ÿéƒ½åœ¨é‡Œé¢, è€Œæˆ‘ä»¬åªéœ€è¦å»è¿è¡Œ`flutter`ç«¯çš„ä»£ç å³å¯è¿›è¡Œæµ‹è¯•

ä¸‹é¢æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸€ä¸‹å§, æˆ‘ä»¬è¿è¡Œ`example`é¡¹ç›®, ä½¿ç”¨å®‰å“æ¨¡æ‹Ÿå™¨è¿›è¡Œæµ‹è¯•

![](images/Pasted%20image%2020240120144723.png)

æˆ‘ä»¬å‘ç°ç•Œé¢ä¸Šæ˜¾ç¤ºé™¤äº†å®‰å“ç³»ç»Ÿçš„ç‰ˆæœ¬, é‚£ä¹ˆæˆ‘ä»¬æ’ä»¶è¿™ä¸€å—çš„æµ‹è¯•ä¹Ÿè°ƒé€šäº†, è¿™å°±æ˜¯æˆ‘ä»¬æœ€ç®€å•çš„äº¤äº’äº†, åŠŸèƒ½æ˜¯`flutter`è·å–åŸç”Ÿè®¾å¤‡çš„ç‰ˆæœ¬å·

# ğŸ è‡ªå®šä¹‰äº¤äº’(å®‰å“)

å­¦ä¹ å®Œä¾‹å­, æƒ³å¿…ä½ å¯¹æ’ä»¶å¼€å‘è¿™ä¸€å—å·²ç»æœ‰ä¸€ç‚¹ç‚¹çš„äº†è§£äº†, é‚£ä¹ˆæˆ‘ä»¬å»è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•, æ¥å®ç°`flutter`ä¸åŸç”Ÿçš„äº¤äº’, æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨å®‰å“å¹³å°ä¸¾ä¾‹å­

## ğŸŒ² å®šä¹‰åŸç”Ÿæ–¹æ³•

å¦‚æœæƒ³è®©`flutter`ä½¿ç”¨æˆ‘ä»¬åŸç”Ÿèƒ½åŠ›, æˆ‘ä»¬é¦–å…ˆè¦åœ¨ç›¸å¯¹åº”çš„å¹³å°ä¸Šå»ç¼–å†™åŸç”Ÿä»£ç æä¾›ç»™`flutter`è°ƒç”¨, æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€æ®µæ ¸å¿ƒä»£ç 

```dart
@Override
public void onMethodCall(@NonNull MethodCall call, @NonNull Result result) {
if (call.method.equals("getPlatformVersion")) {
  result.success("Android " + android.os.Build.VERSION.RELEASE);
} else {
  result.notImplemented();
}
}
```

å¯ä»¥çœ‹åˆ°å½“`flutter`è°ƒç”¨`getPlatformVersion`æ–¹æ³•æ—¶, å®‰å“åŸç”Ÿå°±ä¼šåœ¨`onMethodCall`ä¸­æ”¶åˆ°`call.method`ä¸º`getPlatformVersion`çš„å›è°ƒ, ä»è€Œæˆ‘ä»¬å¯ä»¥åœ¨åŸç”Ÿä¸­å®ç°ç›¸å¯¹åº”çš„äº‹æƒ…ç„¶åå›ä¼ ç»™`flutter`, å›ä¼ æ–¹æ³•å°±æ˜¯`result.success`

é‚£æˆ‘ä»¬æ¥ä¸‹æ¥ä¹Ÿå†™ä¸€ä¸ªç®€å•çš„, æ¯”å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ æ³•, é‚£ä¹ˆå°±åšä¸€ä¸ªåŠ æ³•åŠŸèƒ½, æŠŠç»“æœå›ä¼ ç»™`flutter`

```dart
@Override
public void onMethodCall(@NonNull MethodCall call, @NonNull Result result) {
if (call.method.equals("getPlatformVersion")) {
  result.success("Android " + android.os.Build.VERSION.RELEASE);
}

if (call.method.equals("add")) {
  int a  = call.argument("a");
  int b = call.argument("b");
  result.success(add(a, b));  
}

else {
  result.notImplemented();
}
}

int add(int a, int b) {
return a + b;
}
```

å¯ä»¥çœ‹åˆ°, æˆ‘çš„é€»è¾‘å¾ˆç®€å•, å°±æ˜¯å½“æ”¶åˆ°`add`è¿™ä¸ªå›è°ƒçš„æ—¶å€™, å…ˆè·å–`flutter`ä¼ ç»™æˆ‘ä»¬çš„å‚æ•°, ç„¶åè°ƒç”¨åŸç”Ÿçš„`add`æ–¹æ³•å°†å‚æ•°ç›¸åŠ , æœ€åä½¿ç”¨`result.success`è¿”å›å¯¹åº”çš„ç»“æœç»™åˆ°æˆ‘ä»¬çš„`flutter`

## ğŸŒ² å®šä¹‰flutteræ–¹æ³•

æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªflutteræ–¹æ³•ä¸åŸç”Ÿçš„å¯¹åº”, ç„¶åæŠŠè¿™ä¸ªæ–¹æ³•æä¾›ç»™æˆ‘ä»¬`example`æ¥ä½¿ç”¨, è¿™å°±æ˜¯è‡ªå®šä¹‰æ’ä»¶å¼€å‘äº†

åœ¨flutterä¸­æˆ‘ä»¬éœ€è¦å†™ä¸‰ä¸ªåœ°æ–¹, å…¶ä¸­ä¸¤ä¸ªåœ°æ–¹æ˜¯æ¥å£å’Œå®ç°, ç¬¬ä¸‰ä¸ªåœ°æ–¹å°±æ˜¯æŠŠæˆ‘ä»¬æ’ä»¶çš„èƒ½åŠ›å‘å¤–æš´éœ²å‡ºå»çš„å¦ä¸€ä¸ªæ¥å£, æˆ‘ä»¬ä¸‹é¢å°±å¼€å§‹ç¼–å†™å§

![](images/Pasted%20image%2020240120160521.png)

å°±æ˜¯è¿™ä¸‰ä¸ªæ–‡ä»¶

é¦–å…ˆæ‰“å¼€`test_flutter_plugin_platform_interface.dart`æ–‡ä»¶æ¥å†™ä¸€ä¸ªæ¥å£, è¿™æ²¡æœ‰ä»€ä¹ˆå¥½è§£é‡Šçš„, æˆ‘æ–°åŠ äº†ä¸€ä¸ªæ–¹æ³•å«`add`æ¥åšä¸¤ä¸ªæ•°ç›¸åŠ 

```dart
import 'dart:ffi';

import 'package:plugin_platform_interface/plugin_platform_interface.dart';

import 'test_flutter_plugin_method_channel.dart';

abstract class TestFlutterPluginPlatform extends PlatformInterface {
  /// Constructs a TestFlutterPluginPlatform.
  TestFlutterPluginPlatform() : super(token: _token);

  static final Object _token = Object();

  static TestFlutterPluginPlatform _instance = MethodChannelTestFlutterPlugin();

  /// The default instance of [TestFlutterPluginPlatform] to use.
  ///
  /// Defaults to [MethodChannelTestFlutterPlugin].
  static TestFlutterPluginPlatform get instance => _instance;

  /// Platform-specific implementations should set this with their own
  /// platform-specific class that extends [TestFlutterPluginPlatform] when
  /// they register themselves.
  static set instance(TestFlutterPluginPlatform instance) {
    PlatformInterface.verifyToken(instance, _token);
    _instance = instance;
  }

  Future<String?> getPlatformVersion() {
    throw UnimplementedError('platformVersion() has not been implemented.');
  }

  Future<int?> add(int a, int b) {
    throw UnimplementedError('add() has not been implemented.');
  }
}

```

æ¥å£å†™å¥½ä¹‹åæˆ‘ä»¬æ‰“å¼€`test_flutter_plugin_method_channel.dart`æ–‡ä»¶å»å®ç°è¯¥æ–¹æ³•

```dart
import 'package:flutter/foundation.dart';
import 'package:flutter/services.dart';

import 'test_flutter_plugin_platform_interface.dart';

/// An implementation of [TestFlutterPluginPlatform] that uses method channels.
class MethodChannelTestFlutterPlugin extends TestFlutterPluginPlatform {
  /// The method channel used to interact with the native platform.
  @visibleForTesting
  final methodChannel = const MethodChannel('test_flutter_plugin');

  @override
  Future<String?> getPlatformVersion() async {
    final version =
        await methodChannel.invokeMethod<String>('getPlatformVersion');
    return version;
  }

  @override
  Future<int?> add(int a, int b) async {
    final sum = await methodChannel
        .invokeMethod<int>('add', <String, int>{'a': a, 'b': b});
    return sum;
  }
}
```

æˆ‘ä»¬æ³¨æ„åˆ°, è¿™é‡Œæ¶‰åŠåˆ°äº†flutterè®¿é—®åŸç”Ÿæ–¹æ³•å¹¶ä¼ å‚, ä½¿ç”¨çš„æ˜¯`invokeMethod`æ–¹æ³•, `<int>`æ˜¯ä¸ªæ³›å‹æ ‡è®°äº†è¿”å›å€¼çš„ç±»å‹

ç„¶åæˆ‘ä»¬å†æ‰“å¼€`test_flutter_plugin.dart`æ–‡ä»¶æŠŠæ¥å£æš´æ¼å‡ºæ¥

```dart
import 'test_flutter_plugin_platform_interface.dart';

class TestFlutterPlugin {
  Future<String?> getPlatformVersion() {
    return TestFlutterPluginPlatform.instance.getPlatformVersion();
  }

  Future<int?> add(int a, int b) {
    return TestFlutterPluginPlatform.instance.add(a, b);
  }
}
```

## ğŸŒ² example

ç„¶åæˆ‘ä»¬åœ¨æµ‹è¯•ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªæ’ä»¶æ¥å®ç°`add`åŠŸèƒ½å§

```dart
import 'package:flutter/material.dart';
import 'dart:async';

import 'package:flutter/services.dart';
import 'package:test_flutter_plugin/test_flutter_plugin.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatefulWidget {
  const MyApp({super.key});

  @override
  State<MyApp> createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  String _platformVersion = 'Unknown';
  final _testFlutterPlugin = TestFlutterPlugin();

  @override
  void initState() {
    super.initState();
    initPlatformState();
  }

  // Platform messages are asynchronous, so we initialize in an async method.
  Future<void> initPlatformState() async {
    String platformVersion;
    // Platform messages may fail, so we use a try/catch PlatformException.
    // We also handle the message potentially returning null.
    try {
      platformVersion = await _testFlutterPlugin.getPlatformVersion() ??
          'Unknown platform version';
    } on PlatformException {
      platformVersion = 'Failed to get platform version.';
    }

    // If the widget was removed from the tree while the asynchronous platform
    // message was in flight, we want to discard the reply rather than calling
    // setState to update our non-existent appearance.
    if (!mounted) return;

    setState(() {
      _platformVersion = platformVersion;
    });
  }

  int _result = 0;

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        appBar: AppBar(
          title: const Text('Plugin example app'),
        ),
        body: Center(
          child: Column(children: [
            Text('Running on: $_platformVersion\n'),
            Text('$_result'),
            ElevatedButton(onPressed: _click, child: const Text('ç‚¹å‡»'))
          ]),
        ),
      ),
    );
  }

  void _click() async {
    int sum = await TestFlutterPlugin().add(_result, 1) ?? -1;
    setState(() {
      _result = sum;
    });
  }
}
```

![](images/Pasted%20image%2020240120161117.png)

å¯ä»¥çœ‹åˆ°ä¸Šé¢å°±æ˜¯å®ç°çš„UIç•Œé¢, æ¯æ¬¡ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ä¼šè°ƒç”¨`TestFlutterPlugin().add`æ–¹æ³•æ¥è®©`_result`åŠ ä¸€, æˆ‘ä»¬å‘ç°ä¸Šé¢çš„æ•°å­—æ˜¾ç¤ºçš„æ˜¯æ­£ç¡®çš„, è¯´æ˜äº¤äº’æˆåŠŸäº†

# ğŸ è‡ªå®šä¹‰äº¤äº’(è‹¹æœ)

æˆ‘ä»¬å®‰å“å·²ç»å†™å‡ºæ¥äº†, é‚£ä¹ˆæˆ‘ä»¬è‹¹æœè¦æ€ä¹ˆå†™å‘¢? ç…§è‘«èŠ¦ç”»ç“¢, è¿™æ ¹æœ¬ä¸æ˜¯ä»€ä¹ˆéš¾äº‹!

## ğŸŒ² å®šä¹‰åŸç”Ÿæ–¹æ³•

æˆ‘ä»¬æ‰“å¼€æ ¹ç›®å½•ä¸‹é¢çš„iosæ–‡ä»¶å¤¹, å¯ä»¥çœ‹åˆ°é‡Œé¢å°±å‡ ä¸ªæ–‡ä»¶ç”šè‡³è¿é¡¹ç›®éƒ½ä¸æ˜¯

![](images/Pasted%20image%2020240120165219.png)

è¿™è¦æ€ä¹ˆå»å†™ä»£ç å‘¢? ä¸è¦ç€æ€¥, æˆ‘ä»¬æ¥æ‰“å¼€sampleä¸­çš„å·¥ç¨‹

![](images/Pasted%20image%2020240120165314.png)

åœ¨é‡Œé¢çš„podsä¸­å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬æ’ä»¶çš„ä»£ç , åœ¨è¿™é‡Œå°±å¯ä»¥è¿›è¡Œç¼–å†™äº†

```objective-c
- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {
    if ([@"getPlatformVersion" isEqualToString:call.method]) {
        result([@"iOS " stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);
    }
    
    if ([@"add" isEqualToString:call.method]) {
        int a = [call.arguments[@"a"] intValue];
        int b = [call.arguments[@"b"] intValue];
        result(@([self addWithA:a b:b]));
    }
    
    else {
        result(FlutterMethodNotImplemented);
    }
}

- (int)addWithA:(int)a
              b:(int)b {
    return a + b;
}
```

è‹¹æœä¸­ä¸åŒçš„æ˜¯, `result`æ˜¯ä¸€ä¸ª`block`, æˆ‘ä»¬è°ƒç”¨è¿™ä¸ª`block`å’Œ`flutter`è¿›è¡Œé€šä¿¡

## ğŸŒ² å®šä¹‰flutteræ–¹æ³•

ä¸éœ€è¦å®šä¹‰, å®‰å“è‹¹æœå…±ç”¨ä¸€å¥—

## ğŸŒ² example

æˆ‘ä»¬ä½¿ç”¨iOSæ¨¡æ‹Ÿå™¨è¿è¡Œé¡¹ç›®, å‘ç°æ˜¯å¯ä»¥åšäº¤äº’çš„

![](images/Pasted%20image%2020240120171123.png)



























