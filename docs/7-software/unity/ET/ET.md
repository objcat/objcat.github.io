# ğŸ ç®€ä»‹

`ET`æ˜¯`tanghai`å¤§ä½¬å¼€å‘çš„ä¸€ä¸ª`Unity`å…¨æ ˆæ¸¸æˆæ¡†æ¶, å®ƒé‡‡ç”¨äº†`ESC`çš„è®¾è®¡æ€æƒ³, åŒ…å«`å‰ç«¯+åç«¯`, æˆ‘ä»¬å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå»å¼€å‘æˆ‘ä»¬è‡ªå·±çš„æ¸¸æˆ, æ›´ä¸“æ³¨ä¸è®¾è®¡

https://github.com/egametang/ET

ç«äº‰äº§å“æ˜¯`GameFramework`

https://github.com/EllanJiang/GameFramework

æœ¬æ–‡ä¸»è¦è®²ET

# ğŸ å¿«é€Ÿå¼€å§‹

æˆ‘è¿™é‡Œé€‰æ‹©äº†ET`8.1`, å‚è€ƒè§†é¢‘å¦‚ä¸‹

https://www.bilibili.com/video/BV1rhYyeKExP

https://www.bilibili.com/video/BV1wy411Y7oY

## ğŸŒ² ä¸‹è½½å¹¶è§£å‹

ç›´æ¥å»å®˜ç½‘, åˆ‡æ¢åˆ†æ”¯åˆ°`8.1`

![](images/Pasted%20image%2020250814234248.png)

ç„¶åç›´æ¥æŠŠé¡¹ç›®ä¸‹è½½ä¸‹æ¥å°±å¯ä»¥äº†, è§£å‹å‡ºæ¥å¤§æ¦‚æ˜¯`84M`

![](images/Pasted%20image%2020250814234413.png)

å¯ä»¥çœ‹åˆ°é‡Œé¢çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„

![](images/Pasted%20image%2020250814234804.png)

æ–‡ä»¶çš„å˜åŒ–æˆ‘è¿™é‡Œå»ºäº†ä¸€ä¸ª`Git`ä»“åº“

https://gitee.com/objcat/test-et81

## ğŸŒ² æ‰“å¼€é¡¹ç›®

æˆ‘ä»¬ä½¿ç”¨`Unity Hub`ä¸­çš„`Open`æ‰“å¼€é‡Œé¢çš„`Unity`æ–‡ä»¶å¤¹, ä½œè€…æ¨èçš„`Unity`çš„ç‰ˆæœ¬æ˜¯`2022.3.15`, éå¿…è¦ä¸è¦å»ç”¨åˆ«çš„ç‰ˆæœ¬, æˆ‘æ˜¯æ‡’å¾—ä¸‹è½½äº†, ç”¨çš„`2022.3.16` - -

![](images/Pasted%20image%2020250815002712.png)

æˆ‘çš„ä¼šæç¤ºæˆ‘ç‰ˆæœ¬ä¸å¯¹

![](images/Pasted%20image%2020250816121006.png)

ç„¶åæˆ‘é€‰æ‹©çš„æ˜¯`Choose another Editor verison`, ç„¶åç‚¹å‡»ä¸‹é¢çš„`Open`

![](images/Pasted%20image%2020250816121048.png)

ç„¶åä¼šæœ‰ä¸€ä¸ªä¿®æ”¹`Unityç‰ˆæœ¬`çš„æç¤º

![](images/Pasted%20image%2020250816121129.png)

ç›´æ¥ç‚¹å‡»`Change verison`, å¦‚æœå’Œä½œè€…ä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ª`Unity`ç‰ˆæœ¬ä¸­é—´ä¼šæœ‰å¤šä¸ªå°æç¤º

![](images/Pasted%20image%2020250816121252.png)

ç‚¹å‡»`Continue`å°±å¯ä»¥äº†

![](images/Pasted%20image%2020250815001132.png)

é¡¹ç›®æ‰“å¼€æ˜¯è¿™ä¸ªæ ·å­

![](images/Pasted%20image%2020250816121327.png)

å¯ä»¥çœ‹åˆ°, å®ƒåœ¨å®‰è£…æˆ‘ä»¬æ¸¸æˆæ‰€éœ€è¦çš„åº“

![](images/Pasted%20image%2020250816121911.png)

åˆå§‹é¡¹ç›®æ‰“å¼€æ˜¯è¿™æ ·çš„, å•¥ä¹Ÿæ²¡æœ‰, æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ–‡ä»¶å˜åŒ–

![](images/Pasted%20image%2020250816122132.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°éƒ½æ˜¯æœ‰å…³é¡¹ç›®çš„é…ç½®, è¿™ç±»é…ç½®æ˜¯`Unity`å¸®æˆ‘ä»¬è‡ªåŠ¨æ”¹åŠ¨çš„

## ğŸŒ² åŠ è½½åœºæ™¯

æˆ‘ä»¬é¦–å…ˆåŒå‡»`Scenes`ä¸­çš„`init`

![](images/Pasted%20image%2020250815001453.png)

æˆ‘æ‰“å¼€åæ˜¯è¿™æ ·çš„, åˆ°è¿™é‡Œæˆ‘ä»¬åœºæ™¯å°±çœ‹åˆ°äº†

![](images/Pasted%20image%2020250815002020.png)

## ğŸŒ² é…ç½®Unity

### ğŸŒ¸ é…ç½®é»˜è®¤å·¥å…·

æ‰“å¼€å·¥ç¨‹å, ç‚¹å‡»`èœå•ä¸Šçš„ -> Edit -> Preferences -> External Tools`, ç‚¹å‡»ä¸‹æ‹‰æ¡†`External Script Editor`é€‰æ‹©`Rider`, `Generate .csproj files for`ä¸­çš„é€‰é¡¹å…¨éƒ¨ä¸è¦å‹¾é€‰  

![](images/Pasted%20image%2020250816115413.png)

æˆ‘çš„`Generate .csproj files for`ä¿æŒäº†é»˜è®¤é…ç½®

### ğŸŒ¸ é…ç½®AppType

åœ¨`Project`è§†å›¾ä¸­é€‰ä¸­`Assets/Resources/GlobalConfig`, æŠŠ`AppType`é€‰æ‹©æˆ`Demo(çŠ¶æ€åŒæ­¥)`æˆ–è€…`LockStep(å¸§åŒæ­¥)`

![](images/Pasted%20image%2020250816122319.png)

é»˜è®¤æ˜¯è¿™æ ·çš„, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`App Type`é»˜è®¤é€‰ä¸­çš„æ˜¯`Demo`, é‚£è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ä¸ç”¨æ”¹åŠ¨

## ğŸŒ² å®‰è£…Rider

ä¸€ç¬”å¸¦è¿‡, å¤ªç®€å•äº†

https://www.jetbrains.com/zh-cn/rider/

![](images/Pasted%20image%2020250814235146.png)

## ğŸŒ² ç¼–è¯‘é¡¹ç›®

### ğŸŒ¸ ç¼–è¯‘Unity

![](images/Pasted%20image%2020250816122613.png)

æˆ‘ä»¬åœ¨é¡¹ç›®çª—å£, ç©ºç™½çš„åœ°æ–¹ç‚¹å‡»é¼ æ ‡å³é”®, é€‰æ‹©`Open C# Project`, æ‰“å¼€æ˜¯è¿™æ ·çš„

![](images/Pasted%20image%2020250816122804.png)

ç„¶åæˆ‘ä»¬ç­‰å¾…å®ƒåŠ è½½é¡¹ç›®

![](images/Pasted%20image%2020250816122748.png)

![](images/Pasted%20image%2020250816122821.png)

è¿™ä¸ªæ—¶é—´æ¯”è¾ƒé•¿, éœ€è¦è€å¿ƒç­‰å¾…, ç„¶åç‚¹å‡»å°é”¤å­ç¼–è¯‘ä¸‹

![](images/Pasted%20image%2020250816122917.png)

æˆ‘ä»¬å‘ç°ä¼šå‡ºç°é”™è¯¯

```
2>------- Started building project: Unity.Core
D:\ms\Microsoft Visual Studio\2022\Professional\MSBuild\Current\Bin\Roslyn\csc.exe /noconfig /unsafe+ /nowarn:0169,0649,3021,8981,1701,1702,2008 /fullpaths 
...
2>CSC: Error CS0006 : æœªèƒ½æ‰¾åˆ°å…ƒæ•°æ®æ–‡ä»¶â€œD:\project\unity\test-et81\Share\Analyzer\bin\Debug\Share.Analyzer.dllâ€
2>------- Finished building project: Unity.Core. Succeeded: False. Errors: 1. Warnings: 0
Build completed in 00:00:01.511
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæœªèƒ½æ‰¾åˆ°å…ƒæ•°æ®æ–‡ä»¶çš„é—®é¢˜

```
D:\project\unity\test-et81\Share\Analyzer\bin\Debug\Share.Analyzer.dll
```

ä¸è¦ç€æ€¥, æˆ‘ä»¬æ¥ç¼–è¯‘`ET`

### ğŸŒ¸ ç¼–è¯‘ET

æˆ‘ä»¬åœ¨å·¥ç¨‹ç›®å½•ä½¿ç”¨`Rider`æ‰“å¼€`ET`

![](images/Pasted%20image%2020250816123156.png)

æ‰“å¼€é¡¹ç›®æ˜¯è¿™æ ·çš„

![](images/Pasted%20image%2020250816123514.png)

æˆ‘ä»¬ç­‰å¾…åŠ è½½

![](images/Pasted%20image%2020250816123450.png)

æˆ‘ä»¬ç›´æ¥ç‚¹å‡»ç¼–è¯‘

![](images/Pasted%20image%2020250816123609.png)

å¯ä»¥çœ‹åˆ°æ—¥å¿—æ»šåŠ¨

![](images/Pasted%20image%2020250816124454.png)

è¿™é‡Œæˆ‘æ˜¯èƒ½ç¼–è¯‘æˆåŠŸçš„

![](images/Pasted%20image%2020250816124521.png)

ç„¶åæˆ‘ä»¬å†å›å¤´ç¼–è¯‘`Unity`å‘ç°å¯ä»¥äº†

![](images/Pasted%20image%2020250816124604.png)

æ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†ç»“è®º, ç¼ºå°‘`dll`æ˜¯å› ä¸ºæ²¡æœ‰ç¼–è¯‘`ET`å¯¼è‡´çš„

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§æ›´ç®€å•çš„ç¼–è¯‘`ET`çš„æ–¹å¼

![](images/Pasted%20image%2020250816145855.png)

ç‚¹å‡»`Compile`æˆ–è€…æ˜¯`F6`å¿«æ·é”®

![](images/Pasted%20image%2020250817003416.png)

ä½†æ˜¯è¿™ä¸ª`ç¼–è¯‘æ—¶é—´`æ„Ÿè§‰è¦æ¯”åœ¨`Rider`ä¸­çš„æ—¶é—´é•¿, ç¼–è¯‘å‰æ˜¯ç©ºçš„

![](images/Pasted%20image%2020250817003146.png)

ç¼–è¯‘åå‘ç°ç¡®å®éƒ½å‡ºæ¥äº†

![](images/Pasted%20image%2020250817003458.png)

## ğŸŒ² è¿è¡Œé¡¹ç›®

![](images/Pasted%20image%2020250816124818.png)

æˆ‘ä»¬ç‚¹å‡»`Unity`çš„è¿è¡Œåœºæ™¯, å¯ä»¥çœ‹åˆ°åœºæ™¯å¯ä»¥è¿è¡Œèµ·æ¥

![](images/Pasted%20image%2020250816125145.png)

æˆ‘ä»¬å¯ä»¥å³é”®`Game`, èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ª`Maximize`å¯ä»¥æŠŠçª—å£æ”¾å¤§åˆ°å…¨å±

![](images/Pasted%20image%2020250816125114.png)

ç„¶åæ˜¯è¾“å…¥å¯†ç 

![](images/Pasted%20image%2020250816125234.png)

è¿™ä¸ªæ²¡æœ‰åšé™åˆ¶éšä¾¿è¾“å…¥å³å¯, ç„¶åç‚¹å‡»è¿›å…¥

![](images/Pasted%20image%2020250816125252.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°èƒ½è¿›å…¥æ¸¸æˆäº†

![](images/Pasted%20image%2020250816125313.png)

è¿™å°±æ˜¯`ET`ç»™æˆ‘ä»¬æä¾›çš„`Demo`, é¼ æ ‡å³é”®ç‚¹å‡»å¯ä»¥ç§»åŠ¨è§’è‰²

![](images/Pasted%20image%2020250816125422.png)

Ræ˜¯çƒ­é‡è½½, å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†`ET`çš„ä»£ç å¯ä»¥é‡æ–°`Build`ä¸€æ¬¡`ET`, ç„¶åç‚¹å‡»`R`å¯ä»¥ç›´æ¥çƒ­é‡è½½`dll`, ä¹Ÿå°±æ˜¯è¿™äº›ä¸œè¥¿

![](images/Pasted%20image%2020250816125759.png)

åœ¨å·¥ç¨‹ç›®å½•çœ‹åˆ°çš„ä¼šä¸å¤ªä¸€æ ·, `Unity`å¯èƒ½éšè—äº†åç¼€

![](images/Pasted%20image%2020250816150211.png)

Tæ˜¯åˆ‡æ¢åœ°å›¾

![](images/Pasted%20image%2020250816125829.png)

æˆ‘è¿™é‡Œé¡¹ç›®å°±è¿è¡Œå¥½äº†

# ğŸ å·¥ç¨‹è®²è§£

## ğŸŒ² ç›®å½•ç»“æ„

æˆ‘ä»¬å…ˆæ€»è§ˆä¸€ä¸‹ç›®å½•ç»“æ„, å…¶ä¸­`DotNet`è¿™ä¸ªåŒºåŸŸæ˜¯`æœåŠ¡ç«¯`, `Share`æ˜¯å·¥å…·åŒº, `Unity`æ˜¯`æ¸¸æˆç«¯`ä¹Ÿå¯ä»¥å«`å®¢æˆ·ç«¯`

![](images/Pasted%20image%2020250815003251.png)

## ğŸŒ² Unity(å®¢æˆ·ç«¯)

### ğŸŒ¸ ç¨‹åºå…¥å£

`Unity`çš„ç¨‹åºå…¥å£æ–‡ä»¶æ˜¯è¿™ä¸ª`Assets/Scripts/Loader/MonoBehaviour/Init.cs`, æˆ‘ä»¬ç®€ç•¥çš„çœ‹çœ‹å®ƒéƒ½åšäº†ä»€ä¹ˆ

```cs
using System;
using CommandLine;
using UnityEngine;

namespace ET
{
	public class Init: MonoBehaviour
	{
		private void Start()
		{
			this.StartAsync().Coroutine();
		}
		
		private async ETTask StartAsync()
		{
			DontDestroyOnLoad(gameObject);
			
			AppDomain.CurrentDomain.UnhandledException += (sender, e) =>
			{
				Log.Error(e.ExceptionObject.ToString());
			};

			// å‘½ä»¤è¡Œå‚æ•°
			string[] args = "".Split(" ");
			Parser.Default.ParseArguments<Options>(args)
				.WithNotParsed(error => throw new Exception($"å‘½ä»¤è¡Œæ ¼å¼é”™è¯¯! {error}"))
				.WithParsed((o)=>World.Instance.AddSingleton(o));
			Options.Instance.StartConfig = $"StartConfig/Localhost";
			
			World.Instance.AddSingleton<Logger>().Log = new UnityLogger();
			ETTask.ExceptionHandler += Log.Error;
			
			World.Instance.AddSingleton<TimeInfo>();
			World.Instance.AddSingleton<FiberManager>();

			await World.Instance.AddSingleton<ResourcesComponent>().CreatePackageAsync("DefaultPackage", true);
			
			CodeLoader codeLoader = World.Instance.AddSingleton<CodeLoader>();
			await codeLoader.DownloadAsync();
			
			codeLoader.Start();
		}

		private void Update()
		{
			TimeInfo.Instance.Update();
			FiberManager.Instance.Update();
		}

		private void LateUpdate()
		{
			FiberManager.Instance.LateUpdate();
		}

		private void OnApplicationQuit()
		{
			World.Instance.Dispose();
		}
	}
}
```

ä»£ç å¾ˆå¤šæˆ‘ä»¬æ‰¾å…³é”®çš„å»è®²ä»¥ä¸‹, è®©å¤§å®¶çŸ¥é“ç¨‹åºå¯åŠ¨çš„æ—¶å€™éƒ½åšäº†ä»€ä¹ˆ, é¦–å…ˆæ˜¯è¿™ä¸ª

```cs
World.Instance
```

è¿™ä¸ªä¸œè¥¿æ˜¯ä¸€ä¸ªå…¨å±€ç®¡ç†å™¨, å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹, æ²¡é”™å°±æ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼, å¯ä»¥åœ¨æ•´ä¸ªç¨‹åºçš„å£°æ˜å‘¨æœŸå†…éƒ½å¯ä»¥å‘é‡Œé¢å­˜ä¸œè¥¿æˆ–è€…æŠŠä¸œè¥¿å–å‡ºæ¥, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢å‡ è¡Œä»£ç å°±æ˜¯ä½¿ç”¨`AddSingleton`å¾€`World`ä¸­å»æ³¨å†Œç»„ä»¶

```cs
World.Instance.AddSingleton<Logger>().Log = new UnityLogger();
ETTask.ExceptionHandler += Log.Error;
			
World.Instance.AddSingleton<TimeInfo>();
World.Instance.AddSingleton<FiberManager>();
```

æ³¨å†Œç»„ä»¶çš„æ–¹æ³•æ˜¯`AddSingleton`

```cs
public T AddSingleton<T>() where T : ASingleton, ISingletonAwake, new()
{
	T singleton = new();
	singleton.Awake();

	AddSingleton(singleton);
	return singleton;
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, æ³¨å†Œçš„å…·ä½“æ­¥éª¤å°±æ˜¯é€šè¿‡`new()`æ¨æ–­æ³›å‹æ¥åˆ›å»ºå¯¹è±¡, ç„¶åæ¥è°ƒç”¨`Awake`, è¿™ä¸ª`Awake`æˆ‘ä»¬ç§°ä¸ºæ³¨å†Œæ–¹æ³•, é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆçŸ¥é“æˆ‘ä»¬çš„ç»„ä»¶ä¸­æœ‰`Awake`è¿™ä¸ªæ–¹æ³•å‘¢? æ²¡é”™å°±æ˜¯ç»§æ‰¿, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`public abstract class Singleton<T>: ASingleton where T: Singleton<T>`æ˜¯ä¸ªæŠ½è±¡ç±»

```cs
public class TimeInfo: Singleton<TimeInfo>, ISingletonAwake
{
	public void Awake()
	{
		this.dt1970 = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
		this.dt = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
		this.FrameTime = this.ClientNow();
	}
	æ­¤å¤„çœç•¥ä¸€ä¸‡è¡Œ......
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å®ƒç»§æ‰¿äº†`Singleton`å¹¶å®ç°äº†é‡Œé¢çš„`Awake`æ–¹æ³•

### ğŸŒ¸ CodeLoader

è¿™ä¸ªä¸œè¥¿æ˜¯é‡ä¸­ä¹‹é‡, å®ƒçš„ä¸»è¦ç”¨é€”å’Œä»–çš„åå­—ä¸€æ ·, å°±æ˜¯åŠ è½½ä»£ç ç”¨çš„

```cs
CodeLoader codeLoader = World.Instance.AddSingleton<CodeLoader>();
await codeLoader.DownloadAsync();			
codeLoader.Start();
```

æˆ‘ä»¬é¦–å…ˆçœ‹è¿™ä¸‰è¡Œ, ç¬¬ä¸€è¡Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª`ä»£ç åŠ è½½å™¨`, ç„¶åæ˜¯`await codeLoader.DownloadAsync();`è¿™å¥è¯ä»å­—é¢æ„ä¹‰ä¸Šçœ‹æ˜¯`å¼‚æ­¥ä¸‹è½½`, ä½†æ˜¯æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®ç°é€»è¾‘åˆ™ä¸ç„¶

```cs
public async ETTask DownloadAsync()
{
	if (!Define.IsEditor)
	{
		this.dlls = await ResourcesComponent.Instance.LoadAllAssetsAsync<TextAsset>($"Assets/Bundles/Code/Unity.Model.dll.bytes");
		this.aotDlls = await ResourcesComponent.Instance.LoadAllAssetsAsync<TextAsset>($"Assets/Bundles/AotDlls/mscorlib.dll.bytes");
	}
}
```

æˆ‘ä»¬å‘ç°å®ƒæ˜¯åœ¨æœ¬åœ°å»åŠ è½½ä»£ç çš„, æ ¹æœ¬å°±æ²¡æœ‰è¿œç¨‹è¯·æ±‚, åŠ è½½æˆåŠŸåå…¶å®æ˜¯ä¸€ä¸ªå­—å…¸, æ‰€ä»¥`this.dlls`å’Œ`this.aotDlls`å°±æ˜¯ä¸¤ä¸ªè£…æœ‰`TextAsset`çš„å­—å…¸, è€Œå­—å…¸çš„keyæ˜¯`Unity.Model.dll, Unity.Model.pdb, Unity.ModelView.dll, Unity.ModelView.pdb`, è¿™ä¸ª`TextAsset`ç±»çš„ä»‹ç»æ˜¯`Represents a raw text or binary file asset.` è¡¨ç¤ºåŸå§‹æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶èµ„äº§, ä»¥ä¸‹ç®€ç§°`ä»£ç èµ„äº§`

```cs
public async ETTask<Dictionary<string, T>> LoadAllAssetsAsync<T>(string location) where T : UnityEngine.Object
{
	AllAssetsHandle allAssetsOperationHandle = YooAssets.LoadAllAssetsAsync<T>(location);
	await allAssetsOperationHandle.Task;
	Dictionary<string, T> dictionary = new Dictionary<string, T>();
	foreach (UnityEngine.Object assetObj in allAssetsOperationHandle.AllAssetObjects)
	{
		T t = assetObj as T;
		dictionary.Add(t.name, t);
	}

	allAssetsOperationHandle.Release();
	return dictionary;
}
```

æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹`codeLoader.Start();`

```cs
public void Start()
{
	if (!Define.IsEditor)
	{
		byte[] modelAssBytes = this.dlls["Unity.Model.dll"].bytes;
		byte[] modelPdbBytes = this.dlls["Unity.Model.pdb"].bytes;
		byte[] modelViewAssBytes = this.dlls["Unity.ModelView.dll"].bytes;
		byte[] modelViewPdbBytes = this.dlls["Unity.ModelView.pdb"].bytes;
		// å¦‚æœéœ€è¦æµ‹è¯•ï¼Œå¯æ›¿æ¢æˆä¸‹é¢æ³¨é‡Šçš„ä»£ç ç›´æ¥åŠ è½½Assets/Bundles/Code/Unity.Model.dll.bytesï¼Œä½†çœŸæ­£æ‰“åŒ…æ—¶å¿…é¡»ä½¿ç”¨ä¸Šé¢çš„ä»£ç 
		//modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.Model.dll.bytes"));
		//modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.Model.pdb.bytes"));
		//modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.ModelView.dll.bytes"));
		//modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.ModelView.pdb.bytes"));

		if (Define.EnableIL2CPP)
		{
			foreach (var kv in this.aotDlls)
			{
				TextAsset textAsset = kv.Value;
				RuntimeApi.LoadMetadataForAOTAssembly(textAsset.bytes, HomologousImageMode.SuperSet);
			}
		}
		this.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);
		this.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);
	}
	else
	{
		if (this.enableDll)
		{
			byte[] modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.Model.dll.bytes"));
			byte[] modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.Model.pdb.bytes"));
			byte[] modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.ModelView.dll.bytes"));
			byte[] modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, "Unity.ModelView.pdb.bytes"));
			this.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);
			this.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);
		}
		else
		{
			Assembly[] assemblies = AppDomain.CurrentDomain.GetAssemblies();
			foreach (Assembly ass in assemblies)
			{
				string name = ass.GetName().Name;
				if (name == "Unity.Model")
				{
					this.modelAssembly = ass;
				}
				else if (name == "Unity.ModelView")
				{
					this.modelViewAssembly = ass;
				}

				if (this.modelAssembly != null && this.modelViewAssembly != null)
				{
					break;
				}
			}
		}
	}
	
	(Assembly hotfixAssembly, Assembly hotfixViewAssembly) = this.LoadHotfix();

	World.Instance.AddSingleton<CodeTypes, Assembly[]>(new[]
	{
		typeof (World).Assembly, typeof (Init).Assembly, this.modelAssembly, this.modelViewAssembly, hotfixAssembly,
		hotfixViewAssembly
	});

	IStaticMethod start = new StaticMethod(this.modelAssembly, "ET.Entry", "Start");
	start.Run();
}
```

ç°é˜¶æ®µæˆ‘ä»¬åªå…³æ³¨ä¸€ä¸ªæ ¸å¿ƒä»£ç `Assembly.Load`å°±æ˜¯åŠ¨æ€çš„å»åŠ è½½æˆ‘ä»¬çš„ç¨‹åº, ä¼ å…¥çš„å‚æ•°å°±æ˜¯æˆ‘ä»¬çš„`ä»£ç èµ„äº§`, å®ƒå®ç°ç¨‹åºè°ƒç”¨å¤§æ¦‚æ˜¯é€šè¿‡ä¸‹é¢çš„æ–¹æ³•, æˆ‘ä»¬æ¨¡æ‹Ÿå£°æ˜ä¸€ä¸ªç±»

```cs
namespace MyHotfix
{
    public class Hello
    {
        public static void Say() => Console.WriteLine("Hello Hotfix!");
    }
}
```

ç„¶åæˆ‘ä»¬ä½¿ç”¨`cs`çš„åå°„æ¥è°ƒç”¨è¿™ä¸ªä»£ç 

```cs
byte[] dllBytes = File.ReadAllBytes("MyHotfix.dll");
Assembly hotfixAss = Assembly.Load(dllBytes);

// åå°„è°ƒç”¨
Type helloType = hotfixAss.GetType("MyHotfix.Hello");
MethodInfo say = helloType.GetMethod("Say");
say.Invoke(null, null); // è¾“å‡º "Hello Hotfix!"
```

æ‰€ä»¥`ET`çš„çƒ­æ›´æ–°çš„åŸç†å°±æ˜¯åŠ¨æ€æ›¿æ¢è¿™äº›`dll`, è¿™ä¹Ÿæ˜¯å®ƒä¸ºä»€ä¹ˆè¦æçš„è¿™ä¹ˆéº»çƒ¦çš„åŸå› 

### ğŸŒ¸ ç¼–ç ç›®å½•è§„åˆ™

æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªæ¨¡å—, æ ¹æ®è§†é¢‘è®²è§£, è¿™æ˜¯ä½œè€…ç»™æˆ‘ä»¬æ ¹æ®åŠŸèƒ½åˆ†å‡ºæ¥çš„ä¸åŒçš„`ç¨‹åºé›†`, åœ¨æˆ‘ç†è§£å’ŒJavaä¸­çš„`Maven Module`å·®ä¸å¤š, å°±æ˜¯æ ¹æ®åˆ†å·¥æŠŠä¸€ä¸ªé¡¹ç›®æ‹†æˆä¸€å †å°é¡¹ç›®

- ä¸å®šä¹‰ç›¸å…³çš„æ”¾åœ¨`Model`ä¸­
- ä¸å®ç°ç›¸å…³çš„æ”¾åœ¨`Hotfix`ä¸­
- ä¸è§†å›¾å®šä¹‰ç›¸å…³çš„æ”¾åœ¨`ModelView`ä¸­
- ä¸è§†å›¾å®ç°ç›¸å…³çš„æ”¾åœ¨`HotfixView`ä¸­

ä¸¾ä¸ªä¾‹å­, æˆ‘ä»¬æ‰¾åˆ°

![](images/Pasted%20image%2020250815012037.png)

ç„¶åçœ‹ä¸€ä¸‹å®ƒçš„ä»£ç 

```cs
using UnityEngine;

namespace ET.Client
{
	[ComponentOf(typeof(UI))]
	public class UILoginComponent: Entity, IAwake
	{
		public GameObject account;
		public GameObject password;
		public GameObject loginBtn;
	}
}
```

å®ƒçš„å®ç°å°±åœ¨`Hotfix`ä¸­

![](images/Pasted%20image%2020250815012141.png)

```cs
using UnityEngine;
using UnityEngine.UI;

namespace ET.Client
{
	[EntitySystemOf(typeof(UILoginComponent))]
	[FriendOf(typeof(UILoginComponent))]
	public static partial class UILoginComponentSystem
	{
		[EntitySystem]
		private static void Awake(this UILoginComponent self)
		{
			ReferenceCollector rc = self.GetParent<UI>().GameObject.GetComponent<ReferenceCollector>();
			self.loginBtn = rc.Get<GameObject>("LoginBtn");
			
			self.loginBtn.GetComponent<Button>().onClick.AddListener(()=> { self.OnLogin(); });
			self.account = rc.Get<GameObject>("Account");
			self.password = rc.Get<GameObject>("Password");
		}

		
		public static void OnLogin(this UILoginComponent self)
		{
			LoginHelper.Login(
				self.Root(), 
				self.account.GetComponent<InputField>().text, 
				self.password.GetComponent<InputField>().text).Coroutine();
		}
	}
}
```

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¯ä¸€ä¸ª`Model`å®ç°çš„ä¸œè¥¿éƒ½åœ¨`HotFix`ä¸­æ˜¯æœ‰ä¸€ä¸€å¯¹åº”çš„å®ç°æ–‡ä»¶çš„, å¹¶ä¸”è¿™ä¸ªæ–‡ä»¶æ˜¯`xxxComponentSystem`æ¥å‘½åçš„, è¿™ä¸ªæ–‡ä»¶åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šç¼–è¯‘åˆ°æˆ‘ä»¬åˆšæ‰`CodeLoader`è¯»å–`ä»£ç èµ„äº§`çš„ç›®å½•

### ğŸŒ¸ ç¨‹åºé›†ä¾èµ–

ç¨‹åºé›†ä¹‹é—´æ˜¯å­˜åœ¨ä¾èµ–å…³ç³»çš„, æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„ä¾èµ–æ–‡ä»¶

![](images/Pasted%20image%2020250815012954.png)

å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå«åš`Unity.Core.asmdef`çš„, æˆ‘ä»¬æ‰“å¼€

```json
{
    "name": "Unity.Core",
    "rootNamespace": "ET",
    "references": [
        "Unity.ThirdParty",
        "Unity.Mathematics",
        "MemoryPack"
    ],
    "includePlatforms": [],
    "excludePlatforms": [],
    "allowUnsafeCode": true,
    "overrideReferences": false,
    "precompiledReferences": [],
    "autoReferenced": true,
    "defineConstraints": [],
    "versionDefines": [],
    "noEngineReferences": false
}
```

å¯ä»¥çœ‹åˆ°`Core`ä¾èµ–`Unity.ThirdParty`, å…¶ä»–ç¨‹åºé›†çš„ä¾èµ–å…³ç³»ä¹Ÿå¯ä»¥è‡ªå·±çœ‹çœ‹

## ğŸŒ² DotNet

## ğŸŒ² Tool

# ğŸ é…è¡¨

é…è¡¨çš„ç”¨é€”ç”¨ä¸€å¥è¯æ€»ç»“å°±æ˜¯xxx

æºç ä½ç½®ä¸º`Share/Tool/ExcelExporter/ExcelExporter.cs`æœ‰å…´è¶£å¯ä»¥è‡ªå·±çœ‹çœ‹




