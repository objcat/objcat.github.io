# ğŸ å¤§ä½¬å†™çš„ä»£ç ç”Ÿæˆè„šæœ¬

https://toxicstar.top/index.php/archives/61/

## ğŸŒ² ç¬¬ä¸€ç‰ˆ

```cs
using System;
using System.Collections.Generic;
using System.IO;
using UnityEditor;
using UnityEngine;
using UnityEngine.UI;
using YouYou;

namespace JiangHu.Tools
{
    public class CreateUIScriptTool
    {
        [MenuItem("Assets/ç”ŸæˆUIè„šæœ¬",false,10000)]  //æ³¨é‡Šçœ‹ä¸‹é¢Cell
        public static void CreateUIScript()
        {
            var gameObject = Selection.activeGameObject;
            if (gameObject == null)
            {
                GameEntry.LogError("è¯·é€‰ä¸­é¢„åˆ¶ä½“ï¼");
                return;
            }
            if (!gameObject.name.StartsWith("UI"))
            {
                GameEntry.LogError("è‡ªåŠ¨ç”Ÿæˆä»£ç å¿…é¡»æ˜¯ä»¥UIå¼€å¤´çš„UIé¢„åˆ¶ä½“ï¼");
                return;
            }
            string templateDesignPath = "/Game/YouYouScript/Editor/UITemplateDesign.txt";
            string templatePath = "/Game/YouYouScript/Editor/UITemplate.txt";

            string prefabPath = "Assets/Download/UI/UIPrefab";
            var directoryInfo = new DirectoryInfo(prefabPath);

            List<GameObject> needBindList = new List<GameObject>();
            foreach(var component in gameObject.GetComponentsInChildren<UIBind>())
            {
                needBindList.Add(component.gameObject);
            }

            foreach (var file in directoryInfo.GetFileSystemInfos("*", SearchOption.AllDirectories))
            {
                if (file.Extension.Equals(".prefab"))
                {
                    string name = file.Name.Substring(0, gameObject.name.Length);
                    if (name == gameObject.name)
                    {
                        string scriptDirName = file.FullName.Substring(Application.dataPath.Length + prefabPath.Length - 5);
                        scriptDirName = scriptDirName.Substring(0, scriptDirName.Length - file.Name.Length - 1);

                        string scriptPath = Application.dataPath + "/Game/YouYouScript/UI/" + scriptDirName;
                        if (!Directory.Exists(scriptPath))
                        {
                            Directory.CreateDirectory(scriptPath);
                            Debug.Log("æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼");
                        }

                        string scriptStr = GetTemplateDesignText(name, needBindList, templateDesignPath);
                        using (FileStream fs = new FileStream(string.Format("{0}/{1}.Design.cs", scriptPath, name), FileMode.Create))
                        {
                            using (StreamWriter sw = new StreamWriter(fs))
                            {
                                sw.Write(scriptStr.ToString());
                                Debug.Log("ç»‘å®šå…³ç³»ç”ŸæˆæˆåŠŸï¼");
                            }
                        }

                        string scriptName = scriptPath + "/" + name + ".cs";
                        if (!File.Exists(scriptName))
                        {
                            scriptStr = GetTemplateText(name, needBindList, templatePath);
                            using (FileStream fs = new FileStream(string.Format("{0}/{1}.cs", scriptPath, name), FileMode.Create))
                            {
                                using (StreamWriter sw = new StreamWriter(fs))
                                {
                                    sw.Write(scriptStr.ToString());
                                    Debug.Log("ä¸šåŠ¡ä»£ç ç”ŸæˆæˆåŠŸï¼ä»éœ€æ‰‹åŠ¨å°†ä»£ç æ–‡ä»¶æ‹–åˆ°é¢„åˆ¶ä½“ä¸Šï¼");
                                }
                            }
                        }

                        //å›æ”¶èµ„æº
                        System.GC.Collect();
                        //åˆ·æ–°ç¼–è¾‘å™¨
                        AssetDatabase.Refresh();
                    }
                }
            }
        }

        /// <summary>
        /// ç”Ÿæˆä¸šåŠ¡ä»£ç 
        /// </summary>
        public static string GetTemplateText(string scriptName, List<GameObject> needBindList, string templatePath)
        {
            //è¯»å–æ–‡æœ¬å…¨éƒ¨å†…å®¹
            string designCode = File.ReadAllText(Application.dataPath + templatePath);

            //å¾ªç¯æ·»åŠ OnClickæ–¹æ³•æ–‡æœ¬
            string btnOnClickStr = string.Empty;
            foreach (var go in needBindList)
            {
                if (go.GetComponent<Button>() != null)
                {
                    btnOnClickStr += "        private void OnClick_" + go.name + "()\r\n        {\r\n            Log(\"ç‚¹å‡»äº†" + go.name + "\");\r\n        }\r\n";
                    continue;
                }
            }

            //æ›¿æ¢æ–‡æœ¬
            designCode = designCode.Replace("#ClassName", scriptName)
            .Replace("#BtnOnClick", btnOnClickStr)
            .Replace("#Time", DateTime.Now.ToString());

            return designCode;
        }

        /// <summary>
        /// ç”Ÿæˆç»‘å®šå…³ç³»
        /// </summary>
        public static string GetTemplateDesignText(string scriptName, List<GameObject> needBindList,string templateDesignPath)
        {
            //è¯»å–æ–‡æœ¬å…¨éƒ¨å†…å®¹
            string designCode = File.ReadAllText(Application.dataPath + templateDesignPath);

            //å¾ªç¯æ·»åŠ ç»„ä»¶åˆå§‹åŒ– ç»„ä»¶ç»‘å®š æŒ‰é’®ç»‘å®š
            string initComponentStr = string.Empty;
            string bindComponentStr = string.Empty;
            string btnOnClickStr = string.Empty;
            foreach (var go in needBindList)
            {
                var bind = go.GetComponent<UIBind>();
                var name = go.name;
                if(bind == null)
                {
                    continue;
                }
                bindComponentStr += "            " + name + " = rectTransform.Find(\"" + FindComponentInPrefabPath(scriptName, go) + "\").GetComponent<" + bind.BindComponent.GetType() + ">();\r\n";
                initComponentStr += "\r\n        /// <summary>\r\n        /// " + bind.Content + "\r\n        /// </summary>";
                initComponentStr += "\r\n        private " + bind.BindComponent.GetType() + " " + name + ";\r\n";

                if (go.GetComponent<Button>() != null)
                {
                    btnOnClickStr += "            " + name + ".onClick.AddListener(OnClick_" + name + ");\r\n";
                }
            }

            //æ›¿æ¢æ–‡æœ¬
            designCode = designCode.Replace("#ClassName", scriptName)
            .Replace("#InitComponent", initComponentStr)
            .Replace("#BindComponent", bindComponentStr)
            .Replace("#BtnAddOnClick", btnOnClickStr)
            .Replace("#Time", DateTime.Now.ToString());

            return designCode;
        }

        /// <summary>
        /// å¾ªç¯çˆ¶ç‰©ä½“æ‹¿åˆ°ç»„ä»¶è·¯å¾„
        /// </summary>
        private static string FindComponentInPrefabPath(string scriptName, GameObject go)
        {
            //æ‹¿åˆ°çˆ¶ç‰©ä½“ ä¿®æ”¹è·¯å¾„ è®¾ç½®è·³å‡ºå€¼
            var parentGo = go.transform.parent;
            string path = parentGo.name + "/" + go.name;
            bool isParent = true;

            while (isParent)
            {
                //å¦‚æœçˆ¶ç‰©ä½“åå­—ç­‰äºä¼ è¿›æ¥çš„å¯¹è±¡å å°±é€€å‡º
                if (parentGo.name == scriptName)
                {
                    isParent = false;
                    break;
                }

                //å¾ªç¯æ·»åŠ è·¯å¾„
                parentGo = parentGo.transform.parent;
                path = parentGo.name + "/" + path;
            }

            //åˆ é™¤æœ€ä¸Šçº§ç‰©ä½“å
            path = path.Substring(parentGo.name.Length + 1);

            return path;
        }

        [MenuItem("Assets/ç”ŸæˆCellè„šæœ¬", false, 10000)]
        public static void CreateCellScript()
        {
            //è·å–é€‰ä¸­ç‰©ä½“å¯¹è±¡ åˆ¤æ–­æ˜¯å¦ä¸ºCell
            var gameObject = Selection.activeGameObject;
            if (gameObject == null)
            {
                GameEntry.LogError("è¯·é€‰ä¸­é¢„åˆ¶ä½“ï¼");
                return;
            }
            if (!gameObject.name.EndsWith("Cell"))
            {
                GameEntry.LogError("è‡ªåŠ¨ç”Ÿæˆä»£ç å¿…é¡»æ˜¯ä»¥Cellç»“å°¾çš„Cellé¢„åˆ¶ä½“ï¼");
                return;
            }

            //æ¨¡æ¿è·¯å¾„
            string templateDesignPath = "/Game/YouYouScript/Editor/TemplateDesignCell.txt";
            string templatePath = "/Game/YouYouScript/Editor/TemplateCell.txt";
            //UIè·¯å¾„
            string prefabPath = "Assets/Download/UI/UIPrefab";
            var directoryInfo = new DirectoryInfo(prefabPath);

            //å¾ªç¯æ·»åŠ ç»‘å®šç»„ä»¶
            List<GameObject> needBindList = new List<GameObject>();
            foreach (var component in gameObject.GetComponentsInChildren<UIBind>())
            {
                needBindList.Add(component.gameObject);
            }

            //å¾ªç¯æ‰¾åˆ°å¯¹åº”çš„é¢„åˆ¶ä½“è·¯å¾„
            foreach (var file in directoryInfo.GetFileSystemInfos("*", SearchOption.AllDirectories))
            {
                //æ‰¾åˆ°é¢„åˆ¶ä½“
                if (file.Extension.Equals(".prefab"))
                {
                    string name = file.Name.Substring(0, gameObject.name.Length);
                    //å¦‚æœæ˜¯é€‰ä¸­çš„é¢„åˆ¶ä½“
                    if (name == gameObject.name)
                    {
                        //æ‹¿åˆ°æ–‡ä»¶å¤¹åå­—
                        string scriptDirName = file.FullName.Substring(Application.dataPath.Length + prefabPath.Length - 5);
                        scriptDirName = scriptDirName.Substring(0, scriptDirName.Length - file.Name.Length - 1);

                        //æ‹¿åˆ°æ–‡ä»¶å¤¹è·¯å¾„
                        string scriptPath = Application.dataPath + "/Game/YouYouScript/UI/" + scriptDirName;
                        //å¦‚æœæ²¡æœ‰å°±åˆ›å»º
                        if (!Directory.Exists(scriptPath))
                        {
                            Directory.CreateDirectory(scriptPath);
                            Debug.Log(scriptDirName+"æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼");
                        }

                        //ç”Ÿæˆç»‘å®šå…³ç³»
                        string scriptStr = GetTemplateDesignText(name, needBindList, templateDesignPath);
                        using (FileStream fs = new FileStream(string.Format("{0}/{1}.Design.cs", scriptPath, name), FileMode.Create))
                        {
                            using (StreamWriter sw = new StreamWriter(fs))
                            {
                                sw.Write(scriptStr.ToString());
                                Debug.Log("ç»‘å®šå…³ç³»ç”ŸæˆæˆåŠŸï¼");
                            }
                        }

                        //ç”Ÿæˆä¸šåŠ¡ä»£ç 
                        string scriptName = scriptPath + "/" + name + ".cs";
                        //å¦‚æœä¸å­˜åœ¨æ‰åˆ›å»º
                        if (!File.Exists(scriptName))
                        {
                            scriptStr = GetTemplateText(name, needBindList, templatePath);
                            using (FileStream fs = new FileStream(string.Format("{0}/{1}.cs", scriptPath, name), FileMode.Create))
                            {
                                using (StreamWriter sw = new StreamWriter(fs))
                                {
                                    sw.Write(scriptStr.ToString());
                                    Debug.Log("ä¸šåŠ¡ä»£ç ç”ŸæˆæˆåŠŸï¼ä»éœ€æ‰‹åŠ¨å°†ä»£ç æ‹–åˆ°é¢„åˆ¶ä½“ä¸Šï¼");
                                }
                            }
                        }

                        //å›æ”¶èµ„æº
                        System.GC.Collect();
                        //åˆ·æ–°ç¼–è¾‘å™¨
                        AssetDatabase.Refresh();
                    }
                }
            }
        }
    }
}
```

## ğŸŒ² ç¬¬äºŒç‰ˆ

```cs
using System.IO;
using UnityEditor;
using UnityEngine;

namespace Framework
{
    /// <summary>
    /// UIä»£ç ç”Ÿæˆ
    /// </summary>
    public class GenerateUIScript : Editor
    {
        [MenuItem("GameObject/Generate UI", false, 10000)]
        public static void GenerateUI()
        {
            var go = Selection.activeGameObject;
            if (go == null || !go.name.Contains("UI"))
            {
                Debug.LogError(go.name + " ä¸æ˜¯UIï¼");
                return;
            }

            //å¯»æ‰¾åˆ°å½“å‰objçš„è·¯å¾„
            var directoryInfo = new DirectoryInfo(Application.dataPath);
            string prefabName = go.name + ".prefab";
            string path = string.Empty;
            foreach (var item in directoryInfo.GetFiles("*.*", SearchOption.AllDirectories))
            {
                if (item.Name == prefabName)
                {
                    //é¢„åˆ¶ä½“è·¯å¾„
                    path = item.FullName;
                    //æ›¿æ¢æˆè„šæœ¬è·¯å¾„
                    path = path.Replace("GameData\\Prefabs", "GameData\\Scripts").Substring(0, path.Length - prefabName.Length);
                    break;
                }
            }

            //åˆ›å»ºç›®å½•
            if (!Directory.Exists(path))
            {
                Directory.CreateDirectory(path);
            }
            CreateUIScript(go, path);
            CreateUIDesignScript(go, path);

            Debug.Log(go.name + "ç”Ÿæˆå®Œæ¯•ï¼");
            //å›æ”¶èµ„æº
            System.GC.Collect();
            //åˆ·æ–°ç¼–è¾‘å™¨
            AssetDatabase.Refresh();
        }

        private static void CreateUIScript(GameObject go, string path)
        {
            string temp = @"using Framework;
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace GameData
{
    public partial class #UIName : UIBase
    {
        public override void OnInit()
        {
            
        }

        public override void OnShow(params object[] args)
        {
            
        }

        public override void OnBeforDestroy()
        {
            
        }
    }
}
";

            var scripts = File.CreateText(path + go.name + ".cs");
            temp = temp.Replace("#UIName", go.name);
            scripts.Write(temp);
            scripts.Close();
        }

        private static void CreateUIDesignScript(GameObject go, string path)
        {
            string temp = @"/*********************************************
 * è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶
 * è„šæœ¬åï¼š#UIName.Design.cs
 * ä¿®æ”¹æ—¶é—´ï¼š#Time
 *********************************************/

using Framework;
using UnityEngine;
using UnityEngine.UI;

namespace GameData
{
    public partial class #UIName : UIBase
    {#Component
        public override void OnCreate()
        {
            rectTransform = gameobject.GetComponent<RectTransform>();
            #Find
        }
    }
}
";
            string componentStr = @"
        /// <summary>
        /// #Remark
        /// </summary>
        private #Component #Name;
";
            string FindStr = "#Name = rectTransform.Find(\"#Path\").GetComponent<#Component>();";

            var componentArr = go.GetComponentsInChildren<UIBind>();
            var newComponentStr = string.Empty;
            var newFindStr = string.Empty;
            for (int i = 0; i < componentArr.Length; i++)
            {
                //å£°æ˜å˜é‡
                var tempComponentStr = componentStr.Replace("#Component", componentArr[i].Obj.GetType().ToString());
                tempComponentStr = tempComponentStr.Replace("#Name", componentArr[i].Obj.name);
                tempComponentStr = tempComponentStr.Replace("#Remark", componentArr[i].Remark);
                newComponentStr += tempComponentStr;

                //å¯»æ‰¾å¯¹è±¡
                var tempFindStr = FindStr.Replace("#Component", componentArr[i].Obj.GetType().ToString());
                tempFindStr = tempFindStr.Replace("#Name", componentArr[i].Obj.name);
                tempFindStr = tempFindStr.Replace("#Path", FindComponentInPrefabPath(go.name,componentArr[i].gameObject));
                tempFindStr += "\r\n\t\t\t";
                newFindStr += tempFindStr;
            }

            //åˆ›å»ºå¯¹è±¡
            var scripts = File.CreateText(path + go.name + ".Design.cs");
            //æ–‡æœ¬æ›¿æ¢
            temp = temp.Replace("#UIName", go.name);
            temp = temp.Replace("#Time", System.DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
            temp = temp.Replace("#Component", newComponentStr);
            temp = temp.Replace("#Find", newFindStr);
            scripts.Write(temp);
            scripts.Close();
        }

        /// <summary>
        /// å¾ªç¯çˆ¶ç‰©ä½“æ‹¿åˆ°ç»„ä»¶è·¯å¾„
        /// </summary>
        private static string FindComponentInPrefabPath(string scriptName,GameObject go)
        {
            //æ‹¿åˆ°çˆ¶ç‰©ä½“ ä¿®æ”¹è·¯å¾„ è®¾ç½®è·³å‡ºå€¼
            var parentGo = go.transform.parent;
            string path = parentGo.name + "/" + go.name;
            bool isParent = true;

            while (isParent)
            {
                //å¦‚æœçˆ¶ç‰©ä½“åå­—ç­‰äºä¼ è¿›æ¥çš„å¯¹è±¡å å°±é€€å‡º
                if (parentGo.name == scriptName)
                {
                    isParent = false;
                    break;
                }

                //å¾ªç¯æ·»åŠ è·¯å¾„
                parentGo = parentGo.transform.parent;
                path = parentGo.name + "/" + path;
            }

            //åˆ é™¤æœ€ä¸Šçº§ç‰©ä½“å
            path = path.Substring(parentGo.name.Length + 1);

            return path;
        }
    }
}
```

## ğŸŒ² ç¬¬ä¸‰ç‰ˆ

```cs
ï»¿/*********************************************
 * BFramework
 * UIä»£ç ç”Ÿæˆ
 * åˆ›å»ºæ—¶é—´ï¼š2022/12/25 20:40:23
 *********************************************/
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using UnityEditor;
using UnityEngine;

namespace Framework
{
    /// <summary>
    /// UIä»£ç ç”Ÿæˆ
    /// </summary>
    public class GenerateUIScript : Editor
    {
        [MenuItem("GameObject/ç”ŸæˆUIä»£ç ", false, 10000)]
        public static void GenerateUI()
        {
            var go = Selection.activeGameObject;
            if (go == null || !(go.name.StartsWith("UI") || go.name.StartsWith("Unit")))
            {
                Debug.LogError("æœªé€‰ä¸­UI/Unitï¼");
                return;
            }

            //å¯»æ‰¾åˆ°å½“å‰objçš„è·¯å¾„
            string prefabName = go.name + ".prefab";
            var directoryInfo = new DirectoryInfo(Application.dataPath);
            string path = string.Empty;
            foreach (var item in directoryInfo.GetFiles("*.*", SearchOption.AllDirectories))
            {
                if (item.Name == prefabName)
                {
                    //é¢„åˆ¶ä½“è·¯å¾„
                    path = item.FullName;
                    if (go.name.StartsWith("UI"))
                    {
                        //æ›¿æ¢æˆè„šæœ¬è·¯å¾„
                        path = path.Replace("GameData\\Prefabs", "GameData\\Scripts").Substring(0, path.Length - prefabName.Length);
                    }
                    else
                    {
                        path = path.Replace("GameData\\Prefabs", "GameData\\Scripts").Substring(0, path.Length - prefabName.Length - 6);
                    }
                    break;
                }
            }

            if (string.IsNullOrEmpty(path))
            {
                Debug.LogError("UIå†…çš„Unitè¯·ç›´æ¥ä½¿ç”¨UIç”Ÿæˆä»£ç ");
                return;
            }

            //åˆ›å»ºç›®å½•
            if (!Directory.Exists(path))
            {
                Directory.CreateDirectory(path);
            }

            if (go.name.StartsWith("UI"))
            {
                //åˆ›å»ºç›®å½•
                if (!Directory.Exists(path))
                {
                    Directory.CreateDirectory(path);
                }

                CreateUIScript(go, path);
                CreateUIDesignScript(go, path);
            }
            else if (go.name.StartsWith("Unit"))
            {
                //æ²¡æœ‰çˆ¶ç‰©ä½“å°±ç›´æ¥ç”¨çˆ¶æ–‡ä»¶å¤¹å
                var parentName = new DirectoryInfo(path).Name;
                CreateUnitScript(parentName, go, path);
                CreateUnitDesignScript(parentName, go, path);
            }

            Debug.Log(go.name + "ç”Ÿæˆå®Œæ¯•ï¼");
            //å›æ”¶èµ„æº
            System.GC.Collect();
            //åˆ·æ–°ç¼–è¾‘å™¨
            AssetDatabase.Refresh();
        }

        private static void CreateUIScript(GameObject go, string path)
        {
            string temp = @"/*********************************************
 * 
 * è„šæœ¬åï¼š#UIName.cs
 * åˆ›å»ºæ—¶é—´ï¼š#Time
 *********************************************/
using Framework;
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace GameData
{
    public partial class #UIName : GameUIBase
    {
        public override void OnInit()
        {#ButtonBindFunc
        }

        public override void OnShow(params object[] args)
        {
            
        }
#ButtonOnClick
        protected override void OnBeforeDestroy()
        {
            
        }
    }
}
";
            if (!File.Exists(path + go.name + ".cs"))
            {
                //æŒ‰é’®ç»‘å®šæ–¹æ³•
                string btnBindFunc = string.Empty;
                string btnOnClickStr = string.Empty;
                var bindDatas = FindAllComponent(go);
                for (int i = 0; i < bindDatas.Count; i++)
                {
                    var bindData = bindDatas[i];
                    //ç©ºå°±è·³è¿‡
                    if (bindData == null)
                    {
                        continue;
                    }
                    //å¦‚æœæ˜¯æŒ‰é’® å°±ç›´æ¥è¿½åŠ æ–¹æ³•
                    if (bindData.Type == "ButtonEx")
                    {
                        string funcName = "OnClick_" + bindData.Rect.name;
                        btnBindFunc += "\r\n            " + bindData.Rect.name + ".AddListener(" + funcName + ");";
                        btnOnClickStr += "\r\n        private void " + funcName + "()\r\n        {\r\n            Log(\"ç‚¹å‡»äº†" + bindData.Rect.name + "\");\r\n        }\r\n";
                        continue;
                    }
                }
                //å¦‚æœä¸ºç©º åŠ ä¸ªå›è½¦ ç¾è§‚
                btnBindFunc = string.IsNullOrWhiteSpace(btnBindFunc) ? "\r\n" : btnBindFunc;

                //æ›¿æ¢æ–‡æœ¬
                temp = temp.Replace("#UIName", go.name);
                temp = temp.Replace("#Time", System.DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                temp = temp.Replace("#ButtonBindFunc", btnBindFunc);
                temp = temp.Replace("#ButtonOnClick", btnOnClickStr);
                //å¯¼å‡ºæ–‡ä»¶
                File.WriteAllText(path + go.name + ".cs", temp, Encoding.UTF8);
            }
        }

        /// <summary>
        /// ç”ŸæˆUIç»‘å®šå…³ç³» æ¯æ¬¡è¦†ç›–
        /// </summary>
        /// <param name="go"></param>
        /// <param name="path"></param>
        private static void CreateUIDesignScript(GameObject go, string path)
        {
            string temp = @"/*********************************************
 * è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶
 * è„šæœ¬åï¼š#UIName.Design.cs
 * ä¿®æ”¹æ—¶é—´ï¼š#Time
 *********************************************/

using Framework;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

namespace GameData
{
    public partial class #UIName
    {#Component
        public override void OnCreate()
        {
            rectTransform = gameObject.GetComponent<RectTransform>();
            #Find
        }
    }
}
";
            string newComponentStr;
            string newFindStr;
            //ç”Ÿæˆç»‘å®šå…³ç³»
            GenerateBind(go, path, out newComponentStr, out newFindStr);

            //æ–‡æœ¬æ›¿æ¢
            temp = temp.Replace("#UIName", go.name);
            temp = temp.Replace("#Time", System.DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
            temp = temp.Replace("#Component", newComponentStr);
            temp = temp.Replace("#Find", newFindStr);
            //å¯¼å‡ºæ–‡ä»¶
            var savePath = path + go.name + ".Design.cs";
            if (IsNeedGenerateText(savePath, temp))
            {
                return;
            }
            File.WriteAllText(savePath, temp, Encoding.UTF8);
        }

        /// <summary>
        /// ç”Ÿæˆç»‘å®šå…³ç³»
        /// </summary>
        /// <param name="go">ç›®æ ‡å¯¹è±¡</param>
        /// <param name="path">è„šæœ¬è·¯å¾„</param>
        /// <param name="newComponentStr">æ‹¿å»æ›¿æ¢çš„ç»„ä»¶æ–‡æœ¬</param>
        /// <param name="newFindStr">æ‹¿å»æ›¿æ¢çš„å¯»æ‰¾æ–‡æœ¬</param>
        private static void GenerateBind(GameObject go, string path, out string newComponentStr, out string newFindStr)
        {
            string componentStr = @"
        public #Component #Name;
";
            string UnitStr = "#Name = rectTransform.Find(\"#Path\").gameObject;";
            string FindStr = "#Name = rectTransform.Find(\"#Path\").GetComponent<#Component>();";

            string PoolStr = "#PoolName = new UnitPool<#UnitName>(this,#Obj);";

            newComponentStr = string.Empty;
            newFindStr = string.Empty;
            var bindDatas = FindAllComponent(go);
            for (int i = 0; i < bindDatas.Count; i++)
            {
                var bindData = bindDatas[i];
                //å£°æ˜å˜é‡
                var tempComponentStr = componentStr.Replace("#Name", bindData.Rect.name);
                var componentType = bindData.Type == "Unit" ? "GameObject" : bindData.Type;
                tempComponentStr = tempComponentStr.Replace("#Component", componentType);
                newComponentStr += tempComponentStr;

                //å¯»æ‰¾å¯¹è±¡
                var targetStr = bindData.Type == "Unit" ? UnitStr : FindStr;
                var tempFindStr = targetStr.Replace("#Component", componentType);
                tempFindStr = tempFindStr.Replace("#Name", bindData.Rect.name);
                tempFindStr = tempFindStr.Replace("#Path", FindComponentInPrefabPath(go.name, bindData.Rect.gameObject));
                tempFindStr += "\r\n\t\t\t";
                newFindStr += tempFindStr;

                //Unitç±»å‹
                if (bindData.Type == "Unit")
                {
                    CreateUnitScript(go.name, bindData.Rect.gameObject, path);
                    CreateUnitDesignScript(go.name, bindData.Rect.gameObject, path);

                    var poolName = bindData.Rect.name + "Pool";
                    var className = bindData.Rect.name;

                    //è¿½åŠ ä¸€ä¸ªPool
                    var tempComponentPoolStr = componentStr.Replace("#Name", poolName);
                    tempComponentPoolStr = tempComponentPoolStr.Replace("#Component", "UnitPool<" + className + ">");
                    tempComponentPoolStr = tempComponentPoolStr.Replace("#Content", "");
                    newComponentStr += tempComponentPoolStr;

                    var tempFindPoolStr = PoolStr.Replace("#PoolName", poolName);
                    tempFindPoolStr = tempFindPoolStr.Replace("#UnitName", className);
                    tempFindPoolStr = tempFindPoolStr.Replace("#Obj", bindData.Rect.name);
                    tempFindPoolStr += "\r\n\t\t\t";
                    newFindStr += tempFindPoolStr;
                }
            }
        }

        private static void CreateUnitScript(string uiName, GameObject go, string path)
        {
            string temp = @"/*********************************************
 * 
 * è„šæœ¬åï¼š#UnitName.cs
 * åˆ›å»ºæ—¶é—´ï¼š#Time
 *********************************************/
using Framework;
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace GameData
{
    public partial class #UnitName : UnitBase
    {
        public override void OnInit()
        {
            
        }

        public void OnShow()
        {
            
        }
    }
}
";

            var unitPath = path + "/Unit";
            //åˆ›å»ºç›®å½•
            if (!Directory.Exists(unitPath))
            {
                Directory.CreateDirectory(unitPath);
            }

            var savePath = unitPath + "/" + go.name + ".cs";
            //å·²ç»ç”Ÿæˆè¿‡äº†å°±ä¸è¦†ç›–äº†
            if (!File.Exists(savePath))
            {
                //æ›¿æ¢æ–‡æœ¬
                temp = temp.Replace("#UnitName", go.name);
                temp = temp.Replace("#Time", System.DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                //å¯¼å‡ºæ–‡ä»¶
                File.WriteAllText(savePath, temp, Encoding.UTF8);
            }
        }

        /// <summary>
        /// ç”ŸæˆUnitç»‘å®šå…³ç³» æ¯æ¬¡è¦†ç›–
        /// </summary>
        private static void CreateUnitDesignScript(string uiName, GameObject go, string path)
        {
            string temp = @"/*********************************************
 * è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶
 * è„šæœ¬åï¼š#UnitName.cs
 * ä¿®æ”¹æ—¶é—´ï¼š#Time
 *********************************************/

using Framework;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

namespace GameData
{
    public partial class #UnitName
    {#Component
        public override void OnCreate()
        {
            rectTransform = gameObject.GetComponent<RectTransform>();
            #Find
        }
    }
}
";

            string newComponentStr;
            string newFindStr;
            //ç”Ÿæˆç»‘å®šå…³ç³»
            GenerateBind(go, path, out newComponentStr, out newFindStr);

            var unitPath = path + "/Unit";
            //åˆ›å»ºç›®å½•
            if (!Directory.Exists(unitPath))
            {
                Directory.CreateDirectory(unitPath);
            }

            //æ–‡æœ¬æ›¿æ¢
            temp = temp.Replace("#UnitName", go.name);
            temp = temp.Replace("#Time", System.DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
            temp = temp.Replace("#Component", newComponentStr);
            temp = temp.Replace("#Find", newFindStr);
            //å¯¼å‡ºæ–‡ä»¶
            var savePath = unitPath + "/" + go.name + ".Design.cs";
            if (IsNeedGenerateText(savePath, temp))
            {
                return;
            }
            File.WriteAllText(savePath, temp, Encoding.UTF8);
        }

        /// <summary>
        /// å¾ªç¯çˆ¶ç‰©ä½“æ‹¿åˆ°ç»„ä»¶è·¯å¾„
        /// </summary>
        private static string FindComponentInPrefabPath(string scriptName, GameObject go)
        {
            //æ‹¿åˆ°çˆ¶ç‰©ä½“ ä¿®æ”¹è·¯å¾„ è®¾ç½®è·³å‡ºå€¼
            var parentGo = go.transform.parent;
            string path = parentGo.name + "/" + go.name;
            bool isParent = true;

            while (isParent)
            {
                //å¦‚æœçˆ¶ç‰©ä½“åå­—ç­‰äºä¼ è¿›æ¥çš„å¯¹è±¡å å°±é€€å‡º
                if (parentGo.name == scriptName)
                {
                    isParent = false;
                    break;
                }

                //å¾ªç¯æ·»åŠ è·¯å¾„
                parentGo = parentGo.transform.parent;
                path = parentGo.name + "/" + path;
            }

            //åˆ é™¤æœ€ä¸Šçº§ç‰©ä½“å
            path = path.Substring(parentGo.name.Length + 1);

            return path;
        }

        /// <summary>
        /// æ£€æµ‹æ˜¯å¦éœ€è¦ç”Ÿæˆä»£ç 
        /// </summary>
        private static bool IsNeedGenerateText(string savePath, string newText)
        {
            if (!File.Exists(savePath))
            {
                return false;
            }

            using (var txt = File.OpenText(savePath))
            {
                var oldText = txt.ReadToEnd();
                oldText = oldText.Substring(200, oldText.Length - 200);
                var temp = newText.Substring(200, newText.Length - 200);
                if (oldText.Equals(temp))
                {
                    return true;
                }
            }
            return false;
        }

        private static List<BindData> FindAllComponent(GameObject go)
        {
            var bindDatas = new List<BindData>();
            var childs = go.GetComponentsInChildren<RectTransform>(true).ToList();
            for (int i = 0; i < childs.Count; i++)
            {
                var child = childs[i];
                //è·³è¿‡è‡ªå·±
                if (child.name == go.name)
                {
                    continue;
                }
                //åˆ‡å‰²ç±»å‹å’Œåå­—
                var strArr = child.name.Split('_');
                if (strArr.Length != 2)
                {
                    continue;
                }
                //å¦‚æœUIä¸‹æœ‰Unit å°±æŠŠUnitä¸‹é¢çš„ç»‘å®šç»„ä»¶å…¨éƒ¨ç½®ç©º
                if (child.name.StartsWith("Unit"))
                {
                    var unitChildArr = child.GetComponentsInChildren<RectTransform>(true);
                    foreach (var unitChild in unitChildArr)
                    {
                        //è·³è¿‡è‡ªå·±
                        if (child.name == unitChild.name)
                        {
                            continue;
                        }
                        childs.Remove(unitChild);
                    }
                }

                bindDatas.Add(new BindData()
                {
                    Rect = child,
                    Type = GetTypeByStr(strArr[0])
                });
            }
            return bindDatas;
        }

        private static string GetTypeByStr(string type)
        {
            switch (type)
            {
                case "Lsr":
                    return "LoopScrollRect";
                case "Sv":
                    return "ScrollRect";
                case "Btn":
                    return "ButtonEx";
                case "Inf":
                    return "InputField";
                case "TmpInf":
                    return "TMP_InputField";
                case "Img":
                    return "Image";
                case "Raw":
                    return "RawImage";
                case "Tg":
                    return "Toggle";
                case "Sd":
                    return "Slider";
                case "Tmp":
                    return "TmpEx";
                case "Txt":
                    return "TextEx";
                case "Rt":
                    return "RectTransform";
                case "Unit":
                    return "Unit";
                default:
                    return "Error";
            }
        }
    }

    public class BindData
    {
        public RectTransform Rect;
        public string Type;
    }
}
```